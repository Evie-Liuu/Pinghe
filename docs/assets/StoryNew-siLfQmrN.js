import{B as O,r as f,c as y,C as A,D as H,a as r,o as n,b as t,f as w,g as k,h as C,i as j,e as p,d as u,v as g,n as d,F as $,p as M,q as m,j as q,t as T}from"./index-DSeoTcbi.js";import{C as J}from"./CJKSub-8TmzHbHM.js";import{u as K,i as R,a as W,b as Y,E as P}from"./index--6zVJYH6.js";import{s as Q}from"./SDGs_goal-BU-5yG0n.js";const X={class:"page-background content-scroller"},Z={class:"pt-25 w-full z-10 shadow-md bg-header text-rice-500"},ee={class:"container mx-auto flex items-center p-4"},te={class:"w-1/3"},se={class:"text"},le={class:"max-w-4xl mx-auto p-4 pt-10 text-[1.2rem]"},ae={class:"flex flex-col gap-4"},oe={key:0,class:"text-red-500 text-sm mt-1"},re={class:"mt-2 relative"},ne={class:"relative"},ie=["onClick"],ue=["placeholder"],de=["onClick"],me={key:0,class:"px-3 py-2 text-gray-500"},ve={key:0,class:"text-red-500 text-sm mt-1"},ce={key:0,class:"text-red-500 text-sm mt-1"},fe={class:"mt-1 flex gap-2 items-center"},pe={key:0,class:"text-red-500 text-sm mt-1"},ge={key:1,class:"text-red-500 text-sm mt-1"},be={__name:"StoryNew",setup(xe){q();const s=f({title:"",img_url:"",content:"",intro:"",time:Math.floor(Date.now()/1e3),start_time:"",end_time:"",duration_value:1,duration_unit:"day",types:[]}),x=Q.filter(a=>a.value!==0).map(a=>({...a,title:a.title.replace(/<br\s*\/?>/g,"")})),v=f(""),b=f(!1),h=f(null),D=y(()=>v.value?x.filter(a=>a.title.toLowerCase().includes(v.value.toLowerCase())&&!s.value.types.includes(a.value)):x.filter(a=>!s.value.types.includes(a.value))),S=y(()=>x.filter(a=>s.value.types.includes(a.value)));y(()=>{if(!s.value.start_time||!s.value.duration_value)return"";const a=new Date(s.value.start_time),e=new Date(a);switch(s.value.duration_unit){case"day":e.setDate(e.getDate()+parseInt(s.value.duration_value));break;case"week":e.setDate(e.getDate()+parseInt(s.value.duration_value)*7);break;case"month":e.setMonth(e.getMonth()+parseInt(s.value.duration_value));break}return e.toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})});const L=a=>{s.value.types.includes(a.value)||s.value.types.push(a.value),v.value="",b.value=!1},V=a=>{const e=s.value.types.indexOf(a);e!==-1&&s.value.types.splice(e,1)},E=()=>{},N=(a,e)=>{if(!s.value.start_time){alert("請先選擇開始時間");return}const c=new Date(s.value.start_time),l=new Date(c);switch(e){case"day":l.setDate(l.getDate()+a);break;case"week":l.setDate(l.getDate()+a*7);break;case"month":l.setMonth(l.getMonth()+a);break}const _=l.getFullYear(),z=String(l.getMonth()+1).padStart(2,"0"),B=String(l.getDate()).padStart(2,"0"),F=String(l.getHours()).padStart(2,"0"),G=String(l.getMinutes()).padStart(2,"0");s.value.end_time=`${_}-${z}-${B}T${F}:${G}`},I=()=>{if(!s.value.start_time){alert("請先選擇開始時間");return}N(1,"day")},o=f({title:!1,tags:!1,content:!1,start_time:!1,end_time:!1}),i=K({content:"<p>開始寫下你的故事...</p>",extensions:[R,W,Y.configure({nested:!0})]});A(h,()=>{b.value=!1}),H(()=>{i.value&&i.value.destroy()});const U=()=>{o.value={title:!1,tags:!1,content:!1,start_time:!1,end_time:!1},i.value&&(s.value.content=i.value.getHTML());let a=!1;if(s.value.title.trim()||(o.value.title=!0,a=!0),s.value.types.length===0&&(o.value.tags=!0,a=!0),i.value.isEmpty&&(o.value.content=!0,a=!0),s.value.start_time||(o.value.start_time=!0,a=!0),s.value.end_time&&s.value.start_time){const c=new Date(s.value.start_time);new Date(s.value.end_time)<=c&&(o.value.end_time=!0,a=!0)}if(a)return;const e={...s.value};e.start_time&&(e.start_time=Math.floor(new Date(e.start_time).getTime()/1e3)),e.end_time&&(e.end_time=Math.floor(new Date(e.end_time).getTime()/1e3)),console.log("New Story Data:",e),alert("故事已儲存 (請查看主控台)！")};return(a,e)=>{const c=j("router-link");return n(),r("div",X,[t("header",Z,[t("div",ee,[t("div",te,[w(c,{to:"/story",class:"back-home-btn"},{default:k(()=>[t("span",se,[w(J,{align:"left"},{zh:k(()=>[...e[8]||(e[8]=[C("取消",-1)])]),en:k(()=>[...e[9]||(e[9]=[C("Cancel",-1)])]),_:1})]),e[10]||(e[10]=t("span",{class:"icon"},"←",-1))]),_:1})]),e[11]||(e[11]=t("div",{class:"w-1/3 text-center"},[t("h1",{class:"text-2xl md:text-3xl font-bold"},"建立故事")],-1)),e[12]||(e[12]=t("div",{class:"w-1/3"},null,-1))])]),t("main",le,[t("div",ae,[t("div",null,[e[13]||(e[13]=t("label",{for:"title",class:"block text-lg font-medium"},"標題*",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=l=>s.value.title=l),id:"title",class:d(["mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":o.value.title}])},null,2),[[g,s.value.title]]),o.value.title?(n(),r("p",oe," 請輸入標題 ")):u("",!0)]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-lg font-medium"},"SDGs標籤*",-1)),t("div",re,[t("div",ne,[t("div",{class:d(["flex flex-wrap items-center gap-1 p-2 border border-gray-300 rounded-md shadow-sm focus-within:ring-indigo-500 focus-within:border-indigo-500 min-h-[2.5rem]",{"border-red-500":o.value.tags}])},[(n(!0),r($,null,M(S.value,l=>(n(),r("span",{key:l.value,class:"inline-flex items-center px-2 py-1 text-sm bg-blue-500 text-white rounded-full"},[t("span",null,T(l.title),1),t("button",{onClick:_=>V(l.value),class:"ml-1 text-white hover:text-gray-200"}," × ",8,ie)]))),128)),p(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=l=>v.value=l),onFocus:e[2]||(e[2]=l=>b.value=!0),onInput:E,class:"flex-1 min-w-0 outline-none bg-transparent",placeholder:S.value.length===0?"搜尋SDGs標籤...":"",ref:"searchInput"},null,40,ue),[[g,v.value]])],2),b.value?(n(),r("div",{key:0,ref_key:"dropdown",ref:h,class:"absolute z-10 w-full bg-pblue-200 border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto mt-1"},[(n(!0),r($,null,M(D.value,l=>(n(),r("div",{key:l.value,onClick:_=>L(l),class:"px-3 py-2 hover:bg-orange-300 cursor-pointer"},T(l.title),9,de))),128)),D.value.length===0?(n(),r("div",me," 無匹配的標籤 ")):u("",!0)],512)):u("",!0)]),o.value.tags?(n(),r("p",ve," 請至少選擇一個SDGs標籤 ")):u("",!0)])]),t("div",null,[e[15]||(e[15]=t("label",{for:"intro",class:"block text-lg font-medium"},"簡介",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=l=>s.value.intro=l),id:"intro",class:"mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[g,s.value.intro]])]),t("div",null,[e[16]||(e[16]=t("label",{for:"start_time",class:"block text-lg font-medium"},"時間*",-1)),p(t("input",{type:"datetime-local","onUpdate:modelValue":e[4]||(e[4]=l=>s.value.start_time=l),id:"start_time",class:d(["mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":o.value.start_time}])},null,2),[[g,s.value.start_time]]),o.value.start_time?(n(),r("p",ce," 請選擇開始時間 ")):u("",!0)]),t("div",null,[t("div",fe,[t("button",{onClick:I,class:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600"}," 加入結束時間 "),p(t("input",{type:"datetime-local","onUpdate:modelValue":e[5]||(e[5]=l=>s.value.end_time=l),id:"end_time",class:d(["flex-1 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":o.value.end_time}]),readonly:""},null,2),[[g,s.value.end_time]])]),o.value.end_time?(n(),r("p",pe," 請新增有效的結束時間 ")):u("",!0)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-lg font-medium"},"內容*",-1)),m(i)?(n(),r("div",{key:0,class:d(["border p-2 flex gap-2 rounded-t-md mt-1",{"border-red-500":o.value.content}])},[t("button",{onClick:e[6]||(e[6]=l=>m(i).chain().focus().toggleTaskList().run()),class:d([{"bg-blue-200":m(i).isActive("taskList")},"p-2 rounded hover:bg-blue-200"]),title:"待辦清單"},[...e[17]||(e[17]=[t("i",{class:"fa-solid fa-list-check"},null,-1)])],2),t("button",{onClick:e[7]||(e[7]=l=>m(i).chain().focus().toggleBulletList().run()),class:d([{"bg-blue-200":m(i).isActive("bulletList")},"p-2 rounded hover:bg-blue-200"]),title:"項目符號清單"},[...e[18]||(e[18]=[t("i",{class:"fa-solid fa-list-ul"},null,-1)])],2)],2)):u("",!0),w(m(P),{editor:m(i),class:d(["w-full prose max-w-none border-x border-b p-4 rounded-b-md bg-white text-black",{"border-red-500":o.value.content}])},null,8,["editor","class"]),o.value.content?(n(),r("p",ge," 請輸入內容 ")):u("",!0)]),t("div",{class:"self-end"},[t("button",{onClick:U,class:"bg-green-500 text-white px-6 py-2 rounded-md hover:bg-green-600"}," 儲存 ")])])])])}}},he=O(be,[["__scopeId","data-v-beca67fb"]]);export{he as default};
