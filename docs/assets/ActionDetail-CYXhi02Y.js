import{_ as K,a as U}from"./lightBulb2-t6vOkfMd.js";import{z as W,r as M,C as J,c as v,D as X,a as l,o,b as t,t as g,n as $,e as Q,k as Z,F as h,l as b,d as I,p as w,E as tt,G as et,f as E,g as A,h as F,i as st,x as rt,m as H,y as at}from"./index-CftFP6FL.js";import{C as nt}from"./CJKSub-BHGwHLKd.js";const ot={class:"gantt-chart border border-gray-100 rounded-lg overflow-hidden bg-white"},lt={class:"gantt-header flex bg-gray-100 border-b border-gray-100 relative"},it={class:"absolute top-1 left-1 text-xs text-gray-600 bg-white bg-opacity-80 px-1.5 py-0.5 rounded z-10"},ct={class:"w-1/2 p-3 font-bold text-center text-xs bg-gray-200 border-r border-gray-100 flex flex-col items-center justify-center"},dt={class:"flex flex-1"},ut={key:0,class:"flex items-center justify-center h-32 text-gray-500 bg-gray-50"},mt={key:1,class:"flex items-center justify-center h-32 text-gray-500 bg-gray-50"},gt={key:0,class:"time-column"},vt={class:"flex w-full"},ft={class:"transform -rotate-90 whitespace-nowrap"},yt={class:"w-1/2"},xt={class:"text-xs text-gray-600"},pt={key:1,class:"time-column"},ht={class:"flex w-full"},bt={class:"transform -rotate-90 whitespace-nowrap"},wt={class:"w-1/2"},_t={class:"text-xs text-gray-600"},kt={class:"flex flex-1"},Dt={key:0,class:"post-indicator absolute right-1 top-1/2 transform -translate-y-1/2 z-10"},St=["src"],Tt=["title"],$t={__name:"GanttChart",props:{startTime:{type:Number,required:!0,validator:d=>d>0},endTime:{type:Number,required:!0,validator:d=>d>0},phases:{type:Array,default:()=>[],validator:d=>Array.isArray(d)&&d.every(f=>f&&typeof f.id<"u"&&typeof f.name=="string")},posts:{type:Array,default:()=>[],validator:d=>Array.isArray(d)&&d.every(f=>f&&typeof f.time<"u")},avatar:{type:String,default:""}},emits:["update:scrollTime","phase-click","day-click"],setup(d,{emit:f}){const u=d,i=f,p=M("week"),_=J(null),k=M(u.startTime),D=v(()=>u.startTime>0&&u.endTime>0&&u.endTime>u.startTime);v(()=>D.value?u.endTime-u.startTime:0);const y=new Map([["1-1","元旦"],["2-10","春節"],["2-11","春節"],["2-12","春節"],["4-4","兒童節"],["4-5","清明節"],["6-10","端午節"],["9-17","中秋節"],["10-10","國慶日"]]),a=v(()=>"w-20"),c=v(()=>p.value==="week"?40:30),m=v(()=>{if(!D.value)return[];try{const s=new Date(u.startTime*1e3),e=new Date(u.endTime*1e3);if(isNaN(s.getTime())||isNaN(e.getTime()))return console.warn("Invalid date range provided"),[];const r=[],n=new Date(s),x=3650;let T=0;for(;n<=e&&T<x;)r.push(new Date(n)),n.setDate(n.getDate()+1),T++;return T>=x&&console.warn("Date range too large, truncated to prevent performance issues"),r}catch(s){return console.error("Error generating days array:",s),[]}}),B=v(()=>{const s=new Map;return m.value.forEach(e=>{const r=new Date(e);r.setDate(e.getDate()-e.getDay());const n=r.toISOString().split("T")[0];s.has(n)||s.set(n,{weekStart:r,days:[]}),s.get(n).days.push(e)}),Array.from(s.values())}),L=v(()=>{const s=new Map;return m.value.forEach(e=>{const r=`${e.getFullYear()}-${e.getMonth()+1}`;s.has(r)||s.set(r,{monthStart:new Date(e.getFullYear(),e.getMonth(),1),days:[]}),s.get(r).days.push(e)}),Array.from(s.values())}),S=v(()=>{const s=new Map;try{u.posts.forEach(e=>{if(!e||typeof e.time>"u"){console.warn("Invalid post data:",e);return}const r=parseInt(e.time);if(isNaN(r)){console.warn("Invalid post time:",e.time);return}const n=new Date(r*1e3);if(isNaN(n.getTime())){console.warn("Invalid date from timestamp:",r);return}const x=n.toDateString();s.has(x)||s.set(x,[]),s.get(x).push(e)})}catch(e){console.error("Error processing posts:",e)}return Object.fromEntries(s)}),N=s=>s.getDate(),V=s=>`第${P(s)}週`,Y=s=>`${s.getMonth()+1}月`,P=s=>{const e=new Date(s.getFullYear(),0,1),r=Math.floor((s-e)/(1440*60*1e3));return Math.ceil((r+e.getDay()+1)/7)},j=s=>{const e=new Date(s*1e3);return m.value.findIndex(r=>r.toDateString()===e.toDateString())},C=s=>{if(!s.startTime||!s.endTime)return null;const e=j(s.startTime),r=j(s.endTime);if(e>=0&&r>=0&&e<=r){const n=e*c.value,x=(r-e+1)*c.value;return{top:`${n}px`,height:`${x}px`,left:"50%",transform:"translateX(-50%)"}}return null},O=s=>{const e=s.getDay();return e===0||e===6},R=s=>{if(O(s))return!0;const e=s.getMonth()+1,r=s.getDate(),n=`${e}-${r}`;return y.has(n)},z=s=>{if(!s||typeof s.toDateString!="function")return!1;try{const e=s.toDateString();return S.value[e]&&S.value[e].length>0}catch(e){return console.warn("Error checking posts for day:",s,e),!1}},G=()=>{if(!_.value)return;const s=_.value.scrollTop,e=Math.floor(s/c.value),r=m.value[e];if(r){const n=r.getTime()/1e3;k.value=n,i("update:scrollTime",n)}},q=v(()=>new Date(k.value*1e3).toLocaleDateString("zh-TW",{year:"numeric",month:"long"}));return X(()=>u.startTime,s=>{k.value=s}),(s,e)=>(o(),l("div",ot,[t("div",lt,[t("div",it,g(q.value),1),t("div",{class:$(`${a.value} border-r border-gray-100 flex`)},[t("div",ct,[Q(t("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>p.value=r),class:"block mb-1 text-xs border border-gray-300 rounded px-1 py-0.5 focus:ring-2 focus:ring-blue-500 focus:border-blue-500","aria-label":"選擇時間單位"},[...e[1]||(e[1]=[t("option",{value:"week"},"週",-1),t("option",{value:"month"},"月",-1)])],512),[[Z,p.value]]),e[2]||(e[2]=t("span",{class:"text-xs"},"時間軸",-1))]),e[3]||(e[3]=t("div",{class:"w-1/2 p-3 font-bold text-center text-xs bg-gray-100 flex items-center justify-center"}," 日期 ",-1))],2),t("div",dt,[(o(!0),l(h,null,b(d.phases,r=>(o(),l("div",{key:r.id,class:"flex-1 p-3 font-bold text-center border-r border-gray-100 bg-gray-50 hover:bg-gray-100 transition-colors"},g(r.name),1))),128))])]),D.value?m.value.length===0?(o(),l("div",mt,[...e[5]||(e[5]=[t("div",{class:"text-center"},[t("p",{class:"text-sm"},"沒有可顯示的時間資料"),t("p",{class:"text-xs text-gray-400 mt-1"},"請檢查時間設定")],-1)])])):(o(),l("div",{key:2,class:"gantt-content flex h-150 overflow-y-auto",ref_key:"scrollContainer",ref:_,onScroll:G},[t("div",{class:$(`${a.value} border-r border-gray-100`)},[p.value==="week"?(o(),l("div",gt,[(o(!0),l(h,null,b(B.value,r=>(o(),l("div",{key:r.weekStart.toISOString(),class:"week-group"},[t("div",vt,[t("div",{class:"w-1/2 p-2 font-bold bg-gray-200 border-b border-gray-100 text-center text-xs border-r border-gray-100 flex items-center justify-center",style:w({height:r.days.length*c.value+"px"})},[t("span",ft,g(V(r.weekStart)),1)],4),t("div",yt,[(o(!0),l(h,null,b(r.days,n=>(o(),l("div",{key:n.toISOString(),class:"day-cell w-full flex flex-col items-center justify-center",style:w({height:c.value+"px",minHeight:c.value+"px"})},[t("span",xt,g(N(n)),1)],4))),128))])])]))),128))])):p.value==="month"?(o(),l("div",pt,[(o(!0),l(h,null,b(L.value,r=>(o(),l("div",{key:r.monthStart.toISOString(),class:"month-group"},[t("div",ht,[t("div",{class:"w-1/2 p-2 font-bold bg-gray-200 border-b border-gray-100 text-center text-xs border-r border-gray-100 flex items-center justify-center",style:w({height:r.days.length*c.value+"px"})},[t("span",bt,g(Y(r.monthStart)),1)],4),t("div",wt,[(o(!0),l(h,null,b(r.days,n=>(o(),l("div",{key:n.toISOString(),class:"day-cell w-full flex flex-col items-center justify-center",style:w({height:c.value+"px",minHeight:c.value+"px"})},[t("span",_t,g(N(n)),1)],4))),128))])])]))),128))])):I("",!0)],2),t("div",kt,[(o(!0),l(h,null,b(d.phases,r=>(o(),l("div",{key:r.id,class:"phase-column flex-1 border-r border-gray-100 relative"},[(o(!0),l(h,null,b(m.value,(n,x)=>(o(),l("div",{key:n.toISOString(),class:$(["phase-day-cell relative hover:bg-gray-50 transition-colors",{"bg-gray-200":R(n),weekend:O(n),"has-posts":z(n)}]),style:w({height:c.value+"px",minHeight:c.value+"px"})},[z(n)?(o(),l("div",Dt,[d.avatar?(o(),l("img",{key:0,src:d.avatar,class:"w-5 h-5 rounded-full object-cover border border-white shadow-sm",alt:"使用者頭像"},null,8,St)):(o(),l("div",{key:1,class:"w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-medium",title:`${S.value[n.toDateString()].length} 則貼文`},g(S.value[n.toDateString()].length),9,Tt))])):I("",!0)],6))),128)),C(r)?(o(),l("div",{key:0,class:"phase-line absolute w-0.5 bg-black opacity-80",style:w(C(r))},null,4)):I("",!0)]))),128))])],544)):(o(),l("div",ut,[...e[4]||(e[4]=[t("div",{class:"text-center"},[t("p",{class:"text-sm"},"無效的時間範圍"),t("p",{class:"text-xs text-gray-400 mt-1"},"請確認開始時間小於結束時間")],-1)])]))]))}},It=W($t,[["__scopeId","data-v-fe4e38b0"]]),At={class:"relative z-5 pt-25 w-full shadow-md bg-header text-rice-500"},Mt={class:"container mx-auto flex items-center p-4"},Nt={class:"w-1/3"},jt={class:"text"},Ct={class:"max-w-7xl mx-auto p-6"},Ot={key:0,class:"space-y-6"},zt={class:"bg-white rounded-xl shadow-lg p-6"},Et={class:"flex items-center mb-4",style:{gap:"1rem"}},Ft={class:"flex-1"},Ht={class:"text-xl font-bold text-gray-800 mb-1"},Wt={class:"text-gray-600 text-sm"},Bt={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},Lt={class:"text-gray-600 text-sm mt-1"},Vt={class:"text-gray-600 text-sm mt-1"},Yt={class:"text-gray-600 text-sm mt-1"},Pt={class:"bg-white rounded-xl shadow-lg p-6"},Rt={key:1,class:"text-center py-12 text-gray-500"},Gt={key:1,class:"flex justify-center items-center h-64"},qt={__name:"ActionDetail",setup(d){const f=tt(),u=at("handleAppScroll"),i=M(null),p=v(()=>parseInt(f.params.id)),_=v(()=>{if(!i.value||!i.value.stage)return[];const y=["#4CAF50","#2196F3","#FF9800","#9C27B0"];return Object.entries(i.value.stage).map(([a,c],m)=>({id:parseInt(a)+1,name:c.title,startTime:parseInt(c.startTime),endTime:parseInt(c.endTime),color:y[m%y.length]}))}),k=()=>{if(i.value=U.find(y=>y.id===p.value),!i.value){console.error("Action not found");return}},D=(y,a)=>{if(!y||!a)return"無";const c=new Date(y*1e3).toLocaleDateString("zh-TW"),m=new Date(a*1e3).toLocaleDateString("zh-TW");return`${c} ~ ${m}`};return et(()=>{k()}),(y,a)=>{const c=st("router-link");return o(),l("div",{class:"page-background content-scroller",onScroll:a[0]||(a[0]=(...m)=>H(u)&&H(u)(...m))},[t("div",null,[t("header",At,[t("div",Mt,[t("div",Nt,[E(c,{to:{name:"Actions"},class:"back-home-btn"},{default:A(()=>[t("span",jt,[E(nt,{align:"center"},{zh:A(()=>[...a[1]||(a[1]=[F("返回",-1)])]),en:A(()=>[...a[2]||(a[2]=[F("Back",-1)])]),_:1})]),a[3]||(a[3]=t("span",{class:"icon"},"←",-1))]),_:1})]),a[4]||(a[4]=t("div",{class:"w-1/3 text-center"},[t("h1",{class:"text-2xl md:text-3xl font-bold"},"行動詳情")],-1)),a[5]||(a[5]=t("div",{class:"w-1/3"},null,-1))])]),t("main",Ct,[i.value?(o(),l("div",Ot,[t("div",zt,[t("div",Et,[a[6]||(a[6]=t("img",{src:K,alt:"Action Image",class:"w-16 h-16 rounded-lg object-cover"},null,-1)),t("div",Ft,[t("h2",Ht,g(i.value.title),1),t("p",Wt,g(i.value.group),1)])]),t("div",Bt,[t("div",null,[a[7]||(a[7]=t("span",{class:"font-semibold text-gray-700 text-sm"},"時間：",-1)),t("p",Lt,g(D(i.value.startTime,i.value.endTime)),1)]),t("div",null,[a[8]||(a[8]=t("span",{class:"font-semibold text-gray-700 text-sm"},"進度：",-1)),t("p",Vt,g(i.value.progress)+"% ",1)]),t("div",null,[a[9]||(a[9]=t("span",{class:"font-semibold text-gray-700 text-sm"},"描述：",-1)),t("p",Yt,g(i.value.intro||"暫無描述"),1)])])]),t("div",Pt,[a[11]||(a[11]=t("h3",{class:"text-xl font-bold text-gray-800 mb-6"},"專案甘特圖",-1)),i.value.startTime&&i.value.endTime?(o(),rt(It,{key:0,"start-time":parseInt(i.value.startTime),"end-time":parseInt(i.value.endTime),phases:_.value,posts:i.value.post||[],avatar:"/thumb2.jpg"},null,8,["start-time","end-time","phases","posts"])):(o(),l("div",Rt,[...a[10]||(a[10]=[t("i",{class:"fas fa-chart-bar text-4xl text-gray-300 mb-4"},null,-1),t("p",{class:"text-lg mb-2"},"時間資訊不完整",-1),t("p",{class:"text-sm"},"無法顯示甘特圖",-1)])]))])])):(o(),l("div",Gt,[...a[12]||(a[12]=[t("div",{class:"text-gray-500"},"載入中...",-1)])]))])])],32)}}},Xt=W(qt,[["__scopeId","data-v-dbbac1f7"]]);export{Xt as default};
