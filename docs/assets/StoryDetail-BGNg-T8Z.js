import{_ as se,a as le,b as ae,c as oe,d as ie,e as ne,f as re,g as ue,h as de,i as ge,j as _e,k as ve,l as ce,m as me,n as pe,o as be,p as fe,q as xe,r as ye,s as ke,t as he,u as we,v as Ce,w as Se,x as Te,y as Be,z as Ee,A as Le,B as De,C as Me,D as Ue,E as $e}from"./平和國小_mobile_Example-Bsr5Md9p.js";import{z as ze,u as Ie,r as g,c as E,B as Pe,A as Ve,a,o,b as t,d,f as L,g as D,h as P,i as Ae,p as He,m as u,t as c,F as h,l as w,n as m,e as C,v as S,y as je}from"./index-Bp0L5y2g.js";import{i as Fe,u as Ne}from"./useDateFormat-BFMwo5FP.js";import{s as V}from"./SDGs_goal-BU-5yG0n.js";import{C as Oe}from"./CJKSub-D0RY9TYY.js";import{u as Ge,i as Re,a as Je,b as We,E as qe}from"./index-Bhy7PxhC.js";const Ke={class:"pt-25 w-full z-10 shadow-md bg-header text-rice-500"},Qe={class:"container mx-auto flex items-center p-4"},Xe={class:"w-1/3"},Ye={class:"text"},Ze={class:"max-w-4xl mx-auto p-4 pt-10 text-[1.2rem]"},et={key:0,class:"animate-fade-in-up flex flex-col gap-8"},tt={class:"relative z-10 text-white"},st={class:"text-4xl font-bold mb-4"},lt={class:"mb-2 text-lg"},at={class:"flex flex-wrap gap-2 mt-2"},ot={class:"flex flex-col gap-4 items-start"},it={class:"self-end flex gap-2"},nt=["innerHTML"],rt={key:1,class:"w-full"},ut={key:0,class:"border p-2 flex gap-2 rounded-t-md"},dt={class:"my-20"},gt={class:"flex flex-col gap-4 mb-6 text-black"},_t={class:"font-bold"},vt={class:"text-gray-800"},ct={class:"flex items-center justify-end mt-2"},mt=["onClick"],pt={class:"ml-1"},bt={key:1},ft={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 text-black"},xt={class:"bg-white p-6 rounded-md max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},yt={class:"mb-4"},kt={class:"relative flex flex-wrap items-center"},ht={key:0,class:"absolute right-2 text-red-500"},wt={key:0,class:"text-red-500 text-sm mt-1"},Ct={class:"mb-4"},St={class:"mb-4"},Tt=["value"],Bt={class:"mb-4"},Et={class:"relative"},Lt=["innerHTML"],Dt=["onClick"],Mt=["placeholder"],Ut={key:0,class:"absolute right-2 text-red-500"},$t=["onClick","innerHTML"],zt={key:0,class:"px-3 py-2 text-gray-500"},It={key:1,class:"text-red-500 text-sm mt-1"},Pt={class:"mb-4"},Vt={__name:"StoryDetail",props:{id:String},setup(A){const H=A,M=je("handleAppScroll"),{formatDate:j}=Ne(),{isTeacher:f}=Ie(),i=g(Fe.find(l=>l.id===parseInt(H.id))),v=g(!1),F=E(()=>{if(!i.value)return{};const l=i.value.img_url||"Background_2.png";try{return{backgroundImage:`url(${new URL(Object.assign({"../assets/images/Background_1.png":$e,"../assets/images/Background_1_B.png":Ue,"../assets/images/Background_1_F.png":Me,"../assets/images/Background_2.png":De,"../assets/images/Background_Example.png":Le,"../assets/images/Bar_Selected.png":Ee,"../assets/images/Bar_Unselected.png":Be,"../assets/images/LoadingTrain.png":Te,"../assets/images/Logo.gif":Se,"../assets/images/MainPage_Background.png":Ce,"../assets/images/MainPage_Background.webp":we,"../assets/images/MainPage_Background_T.png":he,"../assets/images/MainPage_Example.png":ke,"../assets/images/MainPage_Pic.png":ye,"../assets/images/MainPage_Pic.webp":xe,"../assets/images/Title.png":fe,"../assets/images/Train_Long.png":be,"../assets/images/Train_Long_Full.png":pe,"../assets/images/Train_Smoke.gif":me,"../assets/images/Train_Smoke_W.gif":ce,"../assets/images/figure1.png":ve,"../assets/images/figure2.png":_e,"../assets/images/figure3.png":ge,"../assets/images/figure4.png":de,"../assets/images/figure5.png":ue,"../assets/images/lightBulb.png":re,"../assets/images/lightBulb2.png":ne,"../assets/images/logo.png":ie,"../assets/images/logo_BW.png":oe,"../assets/images/story_bg.png":ae,"../assets/images/student.png":le,"../assets/images/平和國小_mobile_Example.png":se})[`../assets/images/${l}`],import.meta.url).href})`}}catch{return{backgroundImage:`url(${new URL("/Pinghe/assets/Background_2-C9DmGNh3.png",import.meta.url).href})`}}}),r=Ge({content:"",extensions:[Re,Je,We.configure({nested:!0})]});Pe(()=>{r.value&&r.value.destroy()});const N=()=>{r.value&&r.value.commands.setContent(i.value.content||""),v.value=!0},O=()=>{r.value&&(i.value.content=r.value.getHTML()),v.value=!1,console.log("內容已儲存:",r.value.getJSON()),alert("內容已儲存！")},G=()=>{r.value&&r.value.commands.setContent(i.value.content||""),v.value=!1},R=()=>{navigator.share?navigator.share({title:i.value.title,text:i.value.intro,url:window.location.href}).catch(console.error):(navigator.clipboard.writeText(window.location.href),alert("連結已複製到剪貼簿！"))},T={author_uuid:"0",author:"我"},p=g(""),J=()=>{p.value.trim()!==""&&(i.value.comment.unshift({uuid:Date.now(),author_uuid:T.author_uuid,author:T.author,time:Date.now(),delete_time:null,text:p.value,likes:0,liked:!1}),p.value="")},W=l=>{const e=i.value.comment.find(k=>k.uuid===l);e&&(e.liked?e.likes--:e.likes++,e.liked=!e.liked)},x=g(!1),n=g({...i.value}),b=g(""),y=g(!1),U=g(null),B=V.filter(l=>l.value!==0),$=E(()=>B.filter(l=>n.value.types.includes(l.value))),z=E(()=>b.value?B.filter(l=>l.title.toLowerCase().includes(b.value.toLowerCase())&&!n.value.types.includes(l.value)):B.filter(l=>!n.value.types.includes(l.value)));Ve(U,()=>{y.value=!1});const _=g({title:!1,tags:!1}),q=()=>{n.value={...i.value},x.value=!0},K=()=>{x.value=!1},Q=()=>{let l=!1;n.value.title.trim()||(_.value.title=!0,l=!0),n.value.types.length===0&&(_.value.tags=!0,l=!0),!l&&(i.value.title=n.value.title,i.value.intro=n.value.intro,i.value.time=n.value.time,i.value.types=n.value.types,i.value.img_url=n.value.img_url,x.value=!1)},X=l=>{const e=l.target.files[0];e&&(n.value.img_url=e.name)},Y=l=>{const e=new Date(l.target.value);n.value.time=Math.floor(e.getTime()/1e3)},Z=l=>{n.value.types.includes(l.value)||n.value.types.push(l.value),b.value="",y.value=!1},ee=l=>{const e=n.value.types.indexOf(l);e!==-1&&n.value.types.splice(e,1)},te=()=>{};return(l,e)=>{const k=Ae("router-link");return o(),a("div",{class:"page-background content-scroller",onScroll:e[7]||(e[7]=(...s)=>u(M)&&u(M)(...s))},[t("header",Ke,[t("div",Qe,[t("div",Xe,[L(k,{to:"/story",class:"back-home-btn"},{default:D(()=>[t("span",Ye,[L(Oe,{align:"center"},{zh:D(()=>[...e[8]||(e[8]=[P("回上頁",-1)])]),en:D(()=>[...e[9]||(e[9]=[P("Return",-1)])]),_:1})]),e[10]||(e[10]=t("span",{class:"icon"},"←",-1))]),_:1})]),e[11]||(e[11]=t("div",{class:"w-1/3 text-center"},null,-1)),e[12]||(e[12]=t("div",{class:"w-1/3"},null,-1))])]),t("main",Ze,[i.value?(o(),a("section",et,[t("div",{style:He(F.value),class:"relative bg-cover bg-center bg-opacity-70 p-7 rounded-md md:h-80 grid grid-cols-1 content-end overflow-hidden"},[e[13]||(e[13]=t("div",{class:"absolute inset-0 bg-black/40"},null,-1)),u(f)?(o(),a("button",{key:0,onClick:q,class:"absolute top-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 z-20"}," 編輯 ")):d("",!0),t("div",tt,[t("h1",st,c(i.value.title),1),t("p",lt,c(i.value.intro),1),t("small",null,c(u(j)(i.value.time*1e3)),1),t("div",at,[(o(!0),a(h,null,w(i.value.types,s=>(o(),a("span",{key:s,class:"px-3 py-1 text-sm rounded-full bg-blue-100 text-blue-800"},c(u(V)[s].title.replace(/<br\s*\/?>/gi,"")),1))),128))])])],4),t("section",ot,[t("div",it,[!v.value&&u(f)?(o(),a("button",{key:0,onClick:N,class:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600"}," 編輯內容 ")):d("",!0),v.value&&u(f)?(o(),a("button",{key:1,onClick:O,class:"bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600"}," 儲存 ")):d("",!0),v.value&&u(f)?(o(),a("button",{key:2,onClick:G,class:"bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600"}," 取消 ")):d("",!0),t("button",{onClick:R,class:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600"}," 分享 ")]),v.value?(o(),a("div",rt,[u(r)?(o(),a("div",ut,[t("button",{onClick:e[0]||(e[0]=s=>u(r).chain().focus().toggleTaskList().run()),class:m([{"bg-blue-200":u(r).isActive("taskList")},"p-2 rounded hover:bg-blue-200"]),title:"待辦清單"},[...e[14]||(e[14]=[t("i",{class:"fa-solid fa-list-check"},null,-1)])],2),t("button",{onClick:e[1]||(e[1]=s=>u(r).chain().focus().toggleBulletList().run()),class:m([{"bg-blue-200":u(r).isActive("bulletList")},"p-2 rounded hover:bg-blue-200"]),title:"項目符號清單"},[...e[15]||(e[15]=[t("i",{class:"fa-solid fa-list-ul"},null,-1)])],2)])):d("",!0),L(u(qe),{editor:u(r),class:"w-full prose max-w-none border-x border-b p-4 rounded-b-md"},null,8,["editor"])])):(o(),a("div",{key:0,class:"prose max-w-none",innerHTML:i.value.content},null,8,nt))]),t("section",dt,[e[16]||(e[16]=t("h2",{class:"text-xl mb-4"},"留言板",-1)),t("div",gt,[(o(!0),a(h,null,w(i.value.comment,s=>(o(),a("div",{key:s.uuid,class:m(["p-4 rounded-md",s.author_uuid===T.author_uuid?"bg-green-100":"bg-gray-100"])},[t("p",_t,c(s.author),1),t("p",vt,c(s.text),1),t("div",ct,[t("button",{onClick:I=>W(s.uuid),class:"text-gray-500 hover:text-red-500"},[t("i",{class:m(["fa-heart",s.liked?"fa-solid text-red-500":"fa-regular"])},null,2),t("span",pt,c(s.likes),1)],8,mt)])],2))),128))]),t("div",null,[C(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>p.value=s),class:"w-full p-2 border rounded-md",rows:"3",placeholder:"在這裡寫下你的留言..."},null,512),[[S,p.value]]),t("button",{onClick:J,class:"mt-2 bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600"}," 發布留言 ")])])])):(o(),a("div",bt,[...e[17]||(e[17]=[t("p",null,"找不到這篇故事。",-1)])]))]),x.value?(o(),a("div",ft,[t("div",xt,[e[26]||(e[26]=t("h2",{class:"text-xl mb-4"},"編輯故事",-1)),t("div",yt,[e[19]||(e[19]=t("label",{class:"block text-lg font-medium mb-2"},"標題*",-1)),t("div",kt,[C(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=s=>n.value.title=s),class:m(["w-full p-2 border border-gray-300 rounded-md",{"border-red-500":_.value.title}])},null,2),[[S,n.value.title]]),_.value.title?(o(),a("div",ht,[...e[18]||(e[18]=[t("i",{class:"fa-solid fa-circle-exclamation"},null,-1)])])):d("",!0)]),_.value.title?(o(),a("p",wt," 請輸入標題 ")):d("",!0)]),t("div",Ct,[e[20]||(e[20]=t("label",{class:"block text-lg font-medium mb-2"},"介紹",-1)),C(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=s=>n.value.intro=s),class:"w-full p-2 border border-gray-300 rounded-md"},null,512),[[S,n.value.intro]])]),t("div",St,[e[21]||(e[21]=t("label",{class:"block text-lg font-medium mb-2"},"時間",-1)),t("input",{type:"date",value:n.value.time?new Date(n.value.time*1e3).toISOString().split("T")[0]:"",onInput:Y,class:"w-full p-2 border border-gray-300 rounded-md"},null,40,Tt)]),t("div",Bt,[e[23]||(e[23]=t("label",{class:"block text-lg font-medium mb-2"},"SDGs標籤*",-1)),t("div",Et,[t("div",{class:m(["relative flex flex-wrap items-center gap-1 p-2 border border-gray-300 rounded-md min-h-[2.5rem]",{"border-red-500":_.value.tags}])},[(o(!0),a(h,null,w($.value,s=>(o(),a("span",{key:s.value,class:"inline-flex items-center px-2 py-1 text-sm bg-blue-500 text-white rounded-full"},[t("span",{innerHTML:s.title},null,8,Lt),t("button",{onClick:I=>ee(s.value),class:"ml-1 text-white hover:text-gray-200"}," × ",8,Dt)]))),128)),C(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=s=>b.value=s),onFocus:e[6]||(e[6]=s=>y.value=!0),onInput:te,class:"flex-1 min-w-0 outline-none bg-transparent",placeholder:$.value.length===0?"搜尋SDGs標籤...":""},null,40,Mt),[[S,b.value]]),_.value.tags?(o(),a("div",Ut,[...e[22]||(e[22]=[t("i",{class:"fa-solid fa-circle-exclamation"},null,-1)])])):d("",!0)],2),y.value?(o(),a("div",{key:0,ref_key:"editDropdown",ref:U,class:"absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto mt-1"},[(o(!0),a(h,null,w(z.value,s=>(o(),a("div",{key:s.value,onClick:I=>Z(s),class:"px-3 py-2 hover:bg-orange-300 cursor-pointer",innerHTML:s.title},null,8,$t))),128)),z.value.length===0?(o(),a("div",zt," 無匹配的標籤 ")):d("",!0)],512)):d("",!0),_.value.tags?(o(),a("p",It," 請至少選擇一個SDGs標籤 ")):d("",!0)])]),t("div",Pt,[e[24]||(e[24]=t("label",{class:"block text-lg font-medium mb-2"},"背景圖片",-1)),t("input",{type:"file",onChange:X,accept:"image/*",class:"w-full p-2 border border-gray-300 rounded-md"},null,32),e[25]||(e[25]=t("p",{class:"text-sm text-gray-500 mt-1"}," 選擇新圖片上傳，將替換現有背景圖片。 ",-1))]),t("div",{class:"flex justify-end gap-2"},[t("button",{onClick:K,class:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600"}," 取消 "),t("button",{onClick:Q,class:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600"}," 儲存 ")])])])):d("",!0)],32)}}},Gt=ze(Vt,[["__scopeId","data-v-e1d71f65"]]);export{Gt as default};
