import{_ as oe,a as ie,b as re,c as ue,d as de,e as ge,f as ve,g as ce,h as _e,i as pe,j as me,k as be,l as fe,m as xe,n as he,o as ye,p as ke,q as we,r as Ce,s as Le,t as Se,u as Te,v as Me,w as Be,x as Ee,y as Ue,z as $e,A as De,B as Ie,C as He,D as Ae,E as Re}from"./平和國小_mobile_Example-xpo9UaZU.js";import{B as ze,u as Oe,r as g,c as D,k as je,l as Fe,D as Ne,C as Pe,a as o,o as i,b as t,d,f as I,g as H,h as j,i as Ve,s as Ge,q as u,t as b,F as T,p as M,n as v,e as B,v as E,A as qe}from"./index-Bk2b4twl.js";import{i as Je,u as We}from"./useDateFormat-Bvsj3viC.js";import{s as F}from"./SDGs_goal-BU-5yG0n.js";import{C as Ke}from"./CJKSub-B3xCTqWM.js";import{N as Qe,n as Xe,m as Ye,u as Ze,i as et,a as tt,b as st,c as lt,E as at}from"./index-DoPRvqEV.js";var nt=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,ot=Qe.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:p}){return["img",Ye(this.options.HTMLAttributes,p)]},addCommands(){return{setImage:p=>({commands:f})=>f.insertContent({type:this.name,attrs:p})}},addInputRules(){return[Xe({find:nt,type:this.type,getAttributes:p=>{const[,,f,y,k]=p;return{src:y,alt:f,title:k}}})]}}),it=ot;const rt={class:"pt-25 w-full z-10 shadow-md bg-header text-rice-500"},ut={class:"container mx-auto flex items-center p-4"},dt={class:"w-1/3"},gt={class:"text"},vt={class:"max-w-4xl mx-auto p-4 pt-10 text-[1.2rem]"},ct={key:0,class:"animate-fade-in-up flex flex-col gap-8"},_t={class:"relative z-10 text-white"},pt={class:"text-4xl font-bold mb-4"},mt={class:"mb-2 text-lg"},bt={class:"flex flex-wrap gap-2 mt-2"},ft={class:"flex flex-col gap-4 items-start"},xt={class:"self-end flex gap-2"},ht=["innerHTML"],yt={key:1,class:"w-full"},kt={key:0,class:"border p-2 flex gap-2 rounded-t-md"},wt={class:"my-20"},Ct={class:"flex flex-col gap-4 mb-6 text-black"},Lt={class:"font-bold"},St={class:"text-gray-800"},Tt={class:"flex items-center justify-end mt-2"},Mt=["onClick"],Bt={class:"ml-1"},Et={key:1},Ut={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 text-black"},$t={class:"bg-white p-6 rounded-md max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Dt={class:"mb-4"},It={class:"relative flex flex-wrap items-center"},Ht={key:0,class:"absolute right-2 text-red-500"},At={key:0,class:"text-red-500 text-sm mt-1"},Rt={class:"mb-4"},zt={class:"mb-4"},Ot=["value"],jt={class:"mb-4"},Ft={class:"relative"},Nt=["innerHTML"],Pt=["onClick"],Vt=["placeholder"],Gt={key:0,class:"absolute right-2 text-red-500"},qt=["onClick","innerHTML"],Jt={key:0,class:"px-3 py-2 text-gray-500"},Wt={key:1,class:"text-red-500 text-sm mt-1"},Kt={class:"mb-4"},Qt={__name:"StoryDetail",props:{id:String},setup(p){const f=p,y=qe("handleAppScroll"),{user:k,isTeacher:w}=Oe(),{formatDate:N}=We(),C=g(Je),a=g(null),m=g(!1),P=D(()=>{if(!a.value)return{};const s=a.value.img_url||"Background_2.png";try{return{backgroundImage:`url(${new URL(Object.assign({"../assets/images/Background_1.png":Re,"../assets/images/Background_1_B.png":Ae,"../assets/images/Background_1_F.png":He,"../assets/images/Background_2.png":Ie,"../assets/images/Background_Example.png":De,"../assets/images/Bar_Selected.png":$e,"../assets/images/Bar_Unselected.png":Ue,"../assets/images/LoadingTrain.png":Ee,"../assets/images/Logo.gif":Be,"../assets/images/MainPage_Background.png":Me,"../assets/images/MainPage_Background.webp":Te,"../assets/images/MainPage_Background_T.png":Se,"../assets/images/MainPage_Example.png":Le,"../assets/images/MainPage_Pic.png":Ce,"../assets/images/MainPage_Pic.webp":we,"../assets/images/Title.png":ke,"../assets/images/Train_Long.png":ye,"../assets/images/Train_Long_Full.png":he,"../assets/images/Train_Smoke.gif":xe,"../assets/images/Train_Smoke_W.gif":fe,"../assets/images/figure1.png":be,"../assets/images/figure2.png":me,"../assets/images/figure3.png":pe,"../assets/images/figure4.png":_e,"../assets/images/figure5.png":ce,"../assets/images/lightBulb.png":ve,"../assets/images/lightBulb2.png":ge,"../assets/images/logo.png":de,"../assets/images/logo_BW.png":ue,"../assets/images/story_bg.png":re,"../assets/images/student.png":ie,"../assets/images/平和國小_mobile_Example.png":oe})[`../assets/images/${s}`],import.meta.url).href})`}}catch{return{backgroundImage:`url(${new URL(""+new URL("Background_2-C9DmGNh3.png",import.meta.url).href,import.meta.url).href})`}}}),n=Ze({content:"",extensions:[et,tt,st.configure({nested:!0}),it,lt]});je(async()=>{try{if(k.value){let s=await Fe.getShowcases(k.value.institution_id);console.log(s),C.value=[...C.value,...s.items],console.log(C.value),a.value=C.value.find(e=>e.post_id===f.id),console.log(a.value)}}catch(s){console.error("Failed to fetch posts:",s)}}),Ne(()=>{n.value&&n.value.destroy()});const V=()=>{n.value&&n.value.commands.setContent(a.value.content||""),m.value=!0},G=()=>{n.value&&(a.value.content=n.value.getHTML()),m.value=!1,console.log("內容已儲存:",n.value.getJSON()),alert("內容已儲存！")},q=()=>{n.value&&n.value.commands.setContent(a.value.content||""),m.value=!1},J=()=>{navigator.share?navigator.share({title:a.value.title,text:a.value.intro,url:window.location.href}).catch(console.error):(navigator.clipboard.writeText(window.location.href),alert("連結已複製到剪貼簿！"))},U={author_uuid:"0",author:"我"},x=g(""),W=()=>{x.value.trim()!==""&&(a.value.comment.unshift({uuid:Date.now(),author_uuid:U.author_uuid,author:U.author,time:Date.now(),delete_time:null,text:x.value,likes:0,liked:!1}),x.value="")},K=s=>{const e=a.value.comment.find(_=>_.uuid===s);e&&(e.liked?e.likes--:e.likes++,e.liked=!e.liked)},L=g(!1),r=g({...a.value}),h=g(""),S=g(!1),A=g(null),$=F.filter(s=>s.value!==0),R=D(()=>$.filter(s=>r.value.types.includes(s.value))),z=D(()=>h.value?$.filter(s=>s.title.toLowerCase().includes(h.value.toLowerCase())&&!r.value.types.includes(s.value)):$.filter(s=>!r.value.types.includes(s.value)));Pe(A,()=>{S.value=!1});const c=g({title:!1,tags:!1}),Q=()=>{r.value={...a.value},L.value=!0},X=()=>{L.value=!1},Y=()=>{let s=!1;r.value.title.trim()||(c.value.title=!0,s=!0),r.value.types.length===0&&(c.value.tags=!0,s=!0),!s&&(a.value.title=r.value.title,a.value.intro=r.value.intro,a.value.time=r.value.time,a.value.types=r.value.types,a.value.img_url=r.value.img_url,L.value=!1)},Z=s=>{const e=s.target.files[0];e&&(r.value.img_url=e.name)},ee=s=>{const e=new Date(s.target.value);r.value.time=Math.floor(e.getTime()/1e3)},te=s=>{r.value.types.includes(s.value)||r.value.types.push(s.value),h.value="",S.value=!1},se=s=>{const e=r.value.types.indexOf(s);e!==-1&&r.value.types.splice(e,1)},le=()=>{},ae=s=>{const e=s.target.files[0];if(e&&n.value){const _=URL.createObjectURL(e);n.value.chain().focus().setImage({src:_}).run()}s.target.value=""},ne=s=>{const e=s.target.files[0];if(e&&n.value){const _=URL.createObjectURL(e);n.value.chain().focus().extendMarkRange("link").setLink({href:_}).insertContent(e.name).run()}s.target.value=""};return(s,e)=>{const _=Ve("router-link");return i(),o("div",{class:"page-background content-scroller",onScroll:e[12]||(e[12]=(...l)=>u(y)&&u(y)(...l))},[t("header",rt,[t("div",ut,[t("div",dt,[I(_,{to:"/story",class:"back-home-btn"},{default:H(()=>[t("span",gt,[I(Ke,{align:"center"},{zh:H(()=>[...e[13]||(e[13]=[j("回上頁",-1)])]),en:H(()=>[...e[14]||(e[14]=[j("Return",-1)])]),_:1})]),e[15]||(e[15]=t("span",{class:"icon"},"←",-1))]),_:1})]),e[16]||(e[16]=t("div",{class:"w-1/3 text-center"},null,-1)),e[17]||(e[17]=t("div",{class:"w-1/3"},null,-1))])]),t("main",vt,[a.value?(i(),o("section",ct,[t("div",{style:Ge(P.value),class:"relative bg-cover bg-center bg-opacity-70 p-7 rounded-md md:h-80 grid grid-cols-1 content-end overflow-hidden"},[e[18]||(e[18]=t("div",{class:"absolute inset-0 bg-black/40"},null,-1)),u(w)?(i(),o("button",{key:0,onClick:Q,class:"absolute top-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 z-20"}," 編輯 ")):d("",!0),t("div",_t,[t("h1",pt,b(a.value.title),1),t("p",mt,b(a.value.intro),1),t("small",null,b(u(N)(a.value.time*1e3)),1),t("div",bt,[(i(!0),o(T,null,M(a.value.types,l=>(i(),o("span",{key:l,class:"px-3 py-1 text-sm rounded-full bg-blue-100 text-blue-800"},b(u(F)[l].title.replace(/<br\s*\/?>/gi,"")),1))),128))])])],4),t("section",ft,[t("div",xt,[!m.value&&u(w)?(i(),o("button",{key:0,onClick:V,class:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600"}," 編輯內容 ")):d("",!0),m.value&&u(w)?(i(),o("button",{key:1,onClick:G,class:"bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600"}," 儲存 ")):d("",!0),m.value&&u(w)?(i(),o("button",{key:2,onClick:q,class:"bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600"}," 取消 ")):d("",!0),t("button",{onClick:J,class:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600"}," 分享 ")]),m.value?(i(),o("div",yt,[u(n)?(i(),o("div",kt,[t("button",{onClick:e[0]||(e[0]=l=>u(n).chain().focus().toggleHeading({level:1}).run()),class:v([{"is-active":u(n).isActive("heading",{level:1})},"p-2 rounded hover:bg-blue-200"]),title:"標題 1"}," H1 ",2),t("button",{onClick:e[1]||(e[1]=l=>u(n).chain().focus().toggleHeading({level:2}).run()),class:v([{"is-active":u(n).isActive("heading",{level:2})},"p-2 rounded hover:bg-blue-200"]),title:"標題 2"}," H2 ",2),t("button",{onClick:e[2]||(e[2]=l=>u(n).chain().focus().toggleHeading({level:3}).run()),class:v([{"is-active":u(n).isActive("heading",{level:3})},"p-2 rounded hover:bg-blue-200"]),title:"標題 3"}," H3 ",2),t("button",{onClick:e[3]||(e[3]=l=>u(n).chain().focus().toggleTaskList().run()),class:v([{"bg-blue-200":u(n).isActive("taskList")},"p-2 rounded hover:bg-blue-200"]),title:"待辦清單"},[...e[19]||(e[19]=[t("i",{class:"fa-solid fa-list-check"},null,-1)])],2),t("button",{onClick:e[4]||(e[4]=l=>u(n).chain().focus().toggleBulletList().run()),class:v([{"bg-blue-200":u(n).isActive("bulletList")},"p-2 rounded hover:bg-blue-200"]),title:"項目符號清單"},[...e[20]||(e[20]=[t("i",{class:"fa-solid fa-list-ul"},null,-1)])],2),t("button",{onClick:e[5]||(e[5]=l=>s.$refs.imageInput.click()),class:"p-2 rounded hover:bg-blue-200",title:"插入圖片"},[...e[21]||(e[21]=[t("i",{class:"fa-solid fa-image"},null,-1)])]),t("button",{onClick:e[6]||(e[6]=l=>s.$refs.fileInput.click()),class:"p-2 rounded hover:bg-blue-200",title:"插入檔案"},[...e[22]||(e[22]=[t("i",{class:"fa-solid fa-paperclip"},null,-1)])]),t("input",{ref:"imageInput",type:"file",accept:"image/*",onChange:ae,style:{display:"none"}},null,544),t("input",{ref:"fileInput",type:"file",onChange:ne,style:{display:"none"}},null,544)])):d("",!0),I(u(at),{editor:u(n),class:"w-full prose max-w-none border-x border-b p-4 rounded-b-md overflow-hidden"},null,8,["editor"])])):(i(),o("div",{key:0,class:"prose max-w-none",innerHTML:a.value.content},null,8,ht))]),t("section",wt,[e[23]||(e[23]=t("h2",{class:"text-xl mb-4"},"留言板",-1)),t("div",Ct,[(i(!0),o(T,null,M(a.value.comment,l=>(i(),o("div",{key:l.uuid,class:v(["p-4 rounded-md",l.author_uuid===U.author_uuid?"bg-green-100":"bg-gray-100"])},[t("p",Lt,b(l.author),1),t("p",St,b(l.text),1),t("div",Tt,[t("button",{onClick:O=>K(l.uuid),class:"text-gray-500 hover:text-red-500"},[t("i",{class:v(["fa-heart",l.liked?"fa-solid text-red-500":"fa-regular"])},null,2),t("span",Bt,b(l.likes),1)],8,Mt)])],2))),128))]),t("div",null,[B(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=l=>x.value=l),class:"w-full p-2 border rounded-md",rows:"3",placeholder:"在這裡寫下你的留言..."},null,512),[[E,x.value]]),t("button",{onClick:W,class:"mt-2 bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600"}," 發布留言 ")])])])):(i(),o("div",Et,[...e[24]||(e[24]=[t("p",null,"找不到這篇故事。",-1)])]))]),L.value?(i(),o("div",Ut,[t("div",$t,[e[33]||(e[33]=t("h2",{class:"text-xl mb-4"},"編輯故事",-1)),t("div",Dt,[e[26]||(e[26]=t("label",{class:"block text-lg font-medium mb-2"},"標題*",-1)),t("div",It,[B(t("input",{type:"text","onUpdate:modelValue":e[8]||(e[8]=l=>r.value.title=l),class:v(["w-full p-2 border border-gray-300 rounded-md",{"border-red-500":c.value.title}])},null,2),[[E,r.value.title]]),c.value.title?(i(),o("div",Ht,[...e[25]||(e[25]=[t("i",{class:"fa-solid fa-circle-exclamation"},null,-1)])])):d("",!0)]),c.value.title?(i(),o("p",At," 請輸入標題 ")):d("",!0)]),t("div",Rt,[e[27]||(e[27]=t("label",{class:"block text-lg font-medium mb-2"},"介紹",-1)),B(t("input",{type:"text","onUpdate:modelValue":e[9]||(e[9]=l=>r.value.intro=l),class:"w-full p-2 border border-gray-300 rounded-md"},null,512),[[E,r.value.intro]])]),t("div",zt,[e[28]||(e[28]=t("label",{class:"block text-lg font-medium mb-2"},"時間",-1)),t("input",{type:"date",value:r.value.time?new Date(r.value.time*1e3).toISOString().split("T")[0]:"",onInput:ee,class:"w-full p-2 border border-gray-300 rounded-md"},null,40,Ot)]),t("div",jt,[e[30]||(e[30]=t("label",{class:"block text-lg font-medium mb-2"},"SDGs標籤*",-1)),t("div",Ft,[t("div",{class:v(["relative flex flex-wrap items-center gap-1 p-2 border border-gray-300 rounded-md min-h-[2.5rem]",{"border-red-500":c.value.tags}])},[(i(!0),o(T,null,M(R.value,l=>(i(),o("span",{key:l.value,class:"inline-flex items-center px-2 py-1 text-sm bg-blue-500 text-white rounded-full"},[t("span",{innerHTML:l.title},null,8,Nt),t("button",{onClick:O=>se(l.value),class:"ml-1 text-white hover:text-gray-200"}," × ",8,Pt)]))),128)),B(t("input",{type:"text","onUpdate:modelValue":e[10]||(e[10]=l=>h.value=l),onFocus:e[11]||(e[11]=l=>S.value=!0),onInput:le,class:"flex-1 min-w-0 outline-none bg-transparent",placeholder:R.value.length===0?"搜尋SDGs標籤...":""},null,40,Vt),[[E,h.value]]),c.value.tags?(i(),o("div",Gt,[...e[29]||(e[29]=[t("i",{class:"fa-solid fa-circle-exclamation"},null,-1)])])):d("",!0)],2),S.value?(i(),o("div",{key:0,ref_key:"editDropdown",ref:A,class:"absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto mt-1"},[(i(!0),o(T,null,M(z.value,l=>(i(),o("div",{key:l.value,onClick:O=>te(l),class:"px-3 py-2 hover:bg-orange-300 cursor-pointer",innerHTML:l.title},null,8,qt))),128)),z.value.length===0?(i(),o("div",Jt," 無匹配的標籤 ")):d("",!0)],512)):d("",!0),c.value.tags?(i(),o("p",Wt," 請至少選擇一個SDGs標籤 ")):d("",!0)])]),t("div",Kt,[e[31]||(e[31]=t("label",{class:"block text-lg font-medium mb-2"},"背景圖片",-1)),t("input",{type:"file",onChange:Z,accept:"image/*",class:"w-full p-2 border border-gray-300 rounded-md"},null,32),e[32]||(e[32]=t("p",{class:"text-sm text-gray-500 mt-1"}," 選擇新圖片上傳，將替換現有背景圖片。 ",-1))]),t("div",{class:"flex justify-end gap-2"},[t("button",{onClick:X,class:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600"}," 取消 "),t("button",{onClick:Y,class:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600"}," 儲存 ")])])])):d("",!0)],32)}}},ls=ze(Qt,[["__scopeId","data-v-126c7a85"]]);export{ls as default};
