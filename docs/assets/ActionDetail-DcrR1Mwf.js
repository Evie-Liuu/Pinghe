import{_ as K,a as J}from"./lightBulb2-BHDw-1ez.js";import{B as W,r as A,E as X,c as v,G as Q,a as o,o as n,b as t,t as m,n as S,e as Z,m as ee,F as x,p as b,d as B,s as w,H as te,k as se,f as O,g as M,h as H,i as ae,z as re,q as P,A as ne}from"./index-DSeoTcbi.js";import{C as oe}from"./CJKSub-8TmzHbHM.js";import{_ as ie,a as le,b as de,c as ge,d as ce,e as ue,f as _e,g as me,h as ve,i as fe,j as pe,k as ye,l as xe,m as be,n as he,o as we,p as ke,q as De,r as Te,s as Se,t as $e,u as Ie,v as Be,w as Me,x as Ae,y as je,z as Ne,A as Ce,B as Ee,C as Oe,D as He,E as Pe}from"./平和國小_mobile_Example-Bsr5Md9p.js";const We={class:"gantt-chart border border-gray-200 rounded-xl overflow-hidden bg-white shadow-sm"},ze={class:"gantt-header flex bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200 relative shadow-sm"},Fe={class:"absolute top-2 left-10 text-xs text-gray-700 bg-white bg-opacity-90 px-2 py-1 rounded-md shadow-sm z-10 font-medium"},Le={class:"w-1/2 p-2 font-medium text-center text-xs bg-gray-50 border-r border-gray-200 flex flex-col items-center justify-center gap-1"},Ve={class:"flex flex-1"},Re={key:0,class:"flex items-center justify-center h-32 text-gray-500 bg-gray-50"},Ue={key:1,class:"flex items-center justify-center h-32 text-gray-500 bg-gray-50"},Ye={key:0,class:"time-column"},qe={class:"flex w-full"},Ge={class:"transform -rotate-90 whitespace-nowrap text-gray-700"},Ke={class:"w-1/2"},Je={class:"text-xs text-gray-700 font-medium"},Xe={key:1,class:"time-column"},Qe={class:"flex w-full"},Ze={class:"transform -rotate-90 whitespace-nowrap text-gray-700"},et={class:"w-1/2"},tt={class:"text-xs text-gray-700 font-medium"},st={class:"flex flex-1 border-r border-gray-200"},at={key:0,class:"post-indicator absolute right-2 top-1/2 transform -translate-y-1/2 z-10"},rt=["src"],nt=["title"],ot={__name:"GanttChart",props:{startTime:{type:Number,required:!0,validator:g=>g>0},endTime:{type:Number,required:!0,validator:g=>g>0},phases:{type:Array,default:()=>[],validator:g=>Array.isArray(g)&&g.every(f=>f&&typeof f.id<"u"&&typeof f.name=="string")},posts:{type:Array,default:()=>[],validator:g=>Array.isArray(g)&&g.every(f=>f&&typeof f.time<"u")},avatar:{type:String,default:""}},emits:["update:scrollTime","phase-click","day-click"],setup(g,{emit:f}){const u=g,l=f,y=A("week"),k=X(null),D=A(u.startTime);function $(e){return e?new URL(Object.assign({"../assets/images/Background_1.png":Pe,"../assets/images/Background_1_B.png":He,"../assets/images/Background_1_F.png":Oe,"../assets/images/Background_2.png":Ee,"../assets/images/Background_Example.png":Ce,"../assets/images/Bar_Selected.png":Ne,"../assets/images/Bar_Unselected.png":je,"../assets/images/LoadingTrain.png":Ae,"../assets/images/Logo.gif":Me,"../assets/images/MainPage_Background.png":Be,"../assets/images/MainPage_Background.webp":Ie,"../assets/images/MainPage_Background_T.png":$e,"../assets/images/MainPage_Example.png":Se,"../assets/images/MainPage_Pic.png":Te,"../assets/images/MainPage_Pic.webp":De,"../assets/images/Title.png":ke,"../assets/images/Train_Long.png":we,"../assets/images/Train_Long_Full.png":he,"../assets/images/Train_Smoke.gif":be,"../assets/images/Train_Smoke_W.gif":xe,"../assets/images/figure1.png":ye,"../assets/images/figure2.png":pe,"../assets/images/figure3.png":fe,"../assets/images/figure4.png":ve,"../assets/images/figure5.png":me,"../assets/images/lightBulb.png":_e,"../assets/images/lightBulb2.png":ue,"../assets/images/logo.png":ce,"../assets/images/logo_BW.png":ge,"../assets/images/story_bg.png":de,"../assets/images/student.png":le,"../assets/images/平和國小_mobile_Example.png":ie})[`../assets/images/${e}`],import.meta.url).href:""}const _=v(()=>u.startTime>0&&u.endTime>0&&u.endTime>u.startTime);v(()=>_.value?u.endTime-u.startTime:0);const r=new Map([["1-1","元旦"],["2-10","春節"],["2-11","春節"],["2-12","春節"],["4-4","兒童節"],["4-5","清明節"],["6-10","端午節"],["9-17","中秋節"],["10-10","國慶日"]]),p=v(()=>{if(typeof window<"u"){const e=window.innerWidth;if(e<480)return"w-16";if(e<640)return"w-18";if(e<768)return"w-20"}return"w-20"}),d=v(()=>{if(typeof window<"u"){const e=window.innerWidth;if(e<480)return y.value==="week"?32:24;if(e<768)return y.value==="week"?36:28}return y.value==="week"?42:32}),h=v(()=>{if(!_.value)return[];try{const e=new Date(u.startTime*1e3),s=new Date(u.endTime*1e3);if(isNaN(e.getTime())||isNaN(s.getTime()))return console.warn("Invalid date range provided"),[];const a=[],i=new Date(e),c=3650;let I=0;for(;i<=s&&I<c;)a.push(new Date(i)),i.setDate(i.getDate()+1),I++;return I>=c&&console.warn("Date range too large, truncated to prevent performance issues"),a}catch(e){return console.error("Error generating days array:",e),[]}}),z=v(()=>{const e=new Map;return h.value.forEach(s=>{const a=new Date(s);a.setDate(s.getDate()-s.getDay());const i=a.toISOString().split("T")[0];e.has(i)||e.set(i,{weekStart:a,days:[]}),e.get(i).days.push(s)}),Array.from(e.values())}),F=v(()=>{const e=new Map;return h.value.forEach(s=>{const a=`${s.getFullYear()}-${s.getMonth()+1}`;e.has(a)||e.set(a,{monthStart:new Date(s.getFullYear(),s.getMonth(),1),days:[]}),e.get(a).days.push(s)}),Array.from(e.values())}),T=v(()=>{const e=new Map;try{u.posts.forEach(s=>{if(!s||typeof s.time>"u"){console.warn("Invalid post data:",s);return}const a=parseInt(s.time);if(isNaN(a)){console.warn("Invalid post time:",s.time);return}const i=new Date(a*1e3);if(isNaN(i.getTime())){console.warn("Invalid date from timestamp:",a);return}const c=i.toDateString();e.has(c)||e.set(c,[]),e.get(c).push(s)})}catch(s){console.error("Error processing posts:",s)}return Object.fromEntries(e)}),j=e=>e.getDate(),L=e=>`第${R(e)}週`,V=e=>`${e.getMonth()+1}月`,R=e=>{const s=new Date(e.getFullYear(),0,1),a=Math.floor((e-s)/(1440*60*1e3));return Math.ceil((a+s.getDay()+1)/7)},N=e=>{const s=new Date(e*1e3);return h.value.findIndex(a=>a.toDateString()===s.toDateString())},C=e=>{if(!e.startTime||!e.endTime)return null;const s=N(e.startTime),a=N(e.endTime);if(s>=0&&a>=0&&s<=a){const i=s*d.value,c=(a-s+1)*d.value;return{top:`${i}px`,height:`${c}px`,left:"50%",transform:"translateX(-50%)"}}return null},U=e=>{const s=e.getDay();return s===0||s===6},Y=e=>{const s=e.getMonth()+1,a=e.getDate(),i=`${s}-${a}`;return r.has(i)},E=e=>{if(!e||typeof e.toDateString!="function")return!1;try{const s=e.toDateString();return T.value[s]&&T.value[s].length>0}catch(s){return console.warn("Error checking posts for day:",e,s),!1}},q=()=>{if(!k.value)return;const e=k.value.scrollTop,s=Math.floor(e/d.value),a=h.value[s];if(a){const i=a.getTime()/1e3;D.value=i,l("update:scrollTime",i)}},G=v(()=>new Date(D.value*1e3).toLocaleDateString("zh-TW",{year:"numeric",month:"long"}));return Q(()=>u.startTime,e=>{D.value=e}),(e,s)=>(n(),o("div",We,[t("div",ze,[t("div",Fe,m(G.value),1),t("div",{class:S(`${p.value} border-r border-gray-200 flex text-gray-700`)},[t("div",Le,[Z(t("select",{"onUpdate:modelValue":s[0]||(s[0]=a=>y.value=a),class:"text-xs border border-gray-300 rounded-md px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white shadow-sm","aria-label":"選擇時間單位"},[...s[1]||(s[1]=[t("option",{value:"week"},"週",-1),t("option",{value:"month"},"月",-1)])],512),[[ee,y.value]]),s[2]||(s[2]=t("span",{class:"text-xs text-gray-600 font-normal"},"時間軸",-1))]),s[3]||(s[3]=t("div",{class:"w-1/2 p-2 font-medium text-center text-xs bg-white border-r border-gray-200 flex items-center justify-center text-gray-700"}," 日期 ",-1))],2),t("div",Ve,[(n(!0),o(x,null,b(g.phases,(a,i)=>(n(),o("div",{key:a.id,class:S(["flex-1 p-3 font-semibold text-center bg-gradient-to-b from-gray-50 to-gray-100 hover:from-gray-100 hover:to-gray-200 transition-all duration-200 text-gray-800",{"border-r border-gray-200":i<g.phases.length-1}])},m(a.name),3))),128))])]),_.value?h.value.length===0?(n(),o("div",Ue,[...s[5]||(s[5]=[t("div",{class:"text-center"},[t("p",{class:"text-sm"},"沒有可顯示的時間資料"),t("p",{class:"text-xs text-gray-400 mt-1"},"請檢查時間設定")],-1)])])):(n(),o("div",{key:2,class:"gantt-content flex h-150 overflow-y-auto",ref_key:"scrollContainer",ref:k,onScroll:q},[t("div",{class:S(`${p.value} border-r border-gray-200`)},[y.value==="week"?(n(),o("div",Ye,[(n(!0),o(x,null,b(z.value,a=>(n(),o("div",{key:a.weekStart.toISOString(),class:"week-group"},[t("div",qe,[t("div",{class:"w-1/2 font-semibold bg-gray-100 border-b text-center text-xs border-r border-gray-200 flex items-center justify-center",style:w({height:a.days.length*d.value+"px",minHeight:a.days.length*d.value+"px"})},[t("span",Ge,m(L(a.weekStart)),1)],4),t("div",Ke,[(n(!0),o(x,null,b(a.days,i=>(n(),o("div",{key:i.toISOString(),class:"day-cell w-full flex flex-col items-center justify-center border-b border-gray-200",style:w({height:d.value+"px",minHeight:d.value+"px"})},[t("span",Je,m(j(i)),1)],4))),128))])])]))),128))])):y.value==="month"?(n(),o("div",Xe,[(n(!0),o(x,null,b(F.value,a=>(n(),o("div",{key:a.monthStart.toISOString(),class:"month-group"},[t("div",Qe,[t("div",{class:"w-1/2 font-semibold bg-gray-100 border-b border-gray-200 text-center text-xs border-r border-gray-200 flex items-center justify-center",style:w({height:a.days.length*d.value+"px",minHeight:a.days.length*d.value+"px"})},[t("span",Ze,m(V(a.monthStart)),1)],4),t("div",et,[(n(!0),o(x,null,b(a.days,i=>(n(),o("div",{key:i.toISOString(),class:"day-cell w-full flex flex-col items-center justify-center border-b border-gray-200",style:w({height:d.value+"px",minHeight:d.value+"px"})},[t("span",tt,m(j(i)),1)],4))),128))])])]))),128))])):B("",!0)],2),t("div",st,[(n(!0),o(x,null,b(g.phases,(a,i)=>(n(),o("div",{key:a.id,class:"phase-column flex-1 relative"},[(n(!0),o(x,null,b(h.value,c=>(n(),o("div",{key:c.toISOString(),class:S(["phase-day-cell relative hover:bg-blue-50 transition-colors duration-200 border-r border-gray-200",{"bg-gray-100":Y(c),"bg-gray-50":U(c),"has-posts":E(c)}]),style:w({height:d.value+"px",minHeight:d.value+"px"})},[E(c)?(n(),o("div",at,[g.avatar?(n(),o("img",{key:0,src:$(g.avatar),class:"w-6 h-6 rounded-full object-cover border-2 border-white shadow-md",alt:"使用者頭像"},null,8,rt)):(n(),o("div",{key:1,class:"w-6 h-6 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white text-xs font-semibold shadow-md",title:`${T.value[c.toDateString()].length} 則貼文`},m(T.value[c.toDateString()].length),9,nt))])):B("",!0)],6))),128)),C(a)?(n(),o("div",{key:0,class:"phase-line absolute w-1 bg-gradient-to-b from-blue-500 to-blue-600 opacity-75 rounded-full",style:w(C(a))},null,4)):B("",!0)]))),128))])],544)):(n(),o("div",Re,[...s[4]||(s[4]=[t("div",{class:"text-center"},[t("p",{class:"text-sm"},"無效的時間範圍"),t("p",{class:"text-xs text-gray-400 mt-1"},"請確認開始時間小於結束時間")],-1)])]))]))}},it=W(ot,[["__scopeId","data-v-c7ec3c4d"]]),lt={class:"relative z-5 pt-25 w-full shadow-md bg-header text-rice-500"},dt={class:"container mx-auto flex items-center p-4"},gt={class:"w-1/3"},ct={class:"text"},ut={class:"max-w-7xl mx-auto p-6 text-sm"},_t={key:0,class:"space-y-6"},mt={class:"bg-white rounded-xl shadow-lg p-6"},vt={class:"flex items-center mb-4",style:{gap:"1rem"}},ft={class:"flex-1"},pt={class:"text-xl font-bold text-gray-800 mb-1"},yt={class:"text-gray-600 text-sm"},xt={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},bt={class:"text-gray-600 text-sm mt-1"},ht={class:"text-gray-600 text-sm mt-1"},wt={class:"text-gray-600 text-sm mt-1"},kt={class:"bg-white rounded-xl shadow-lg p-6"},Dt={key:1,class:"text-center py-12 text-gray-500"},Tt={key:1,class:"flex justify-center items-center h-64"},St={__name:"ActionDetail",setup(g){const f=te(),u=ne("handleAppScroll"),l=A(null),y=v(()=>parseInt(f.params.id)),k=v(()=>{if(!l.value||!l.value.stage)return[];const _=["#4CAF50","#2196F3","#FF9800","#9C27B0"];return Object.entries(l.value.stage).map(([r,p],d)=>({id:parseInt(r)+1,name:p.title,startTime:parseInt(p.startTime),endTime:parseInt(p.endTime),color:_[d%_.length]}))}),D=()=>{if(l.value=J.find(_=>_.id===y.value),!l.value){console.error("Action not found");return}},$=(_,r)=>{if(!_||!r)return"無";const p=new Date(_*1e3).toLocaleDateString("zh-TW"),d=new Date(r*1e3).toLocaleDateString("zh-TW");return`${p} ~ ${d}`};return se(()=>{D()}),(_,r)=>{const p=ae("router-link");return n(),o("div",{class:"page-background content-scroller",onScroll:r[0]||(r[0]=(...d)=>P(u)&&P(u)(...d))},[t("div",null,[t("header",lt,[t("div",dt,[t("div",gt,[O(p,{to:{name:"Actions"},class:"back-home-btn"},{default:M(()=>[t("span",ct,[O(oe,{align:"center"},{zh:M(()=>[...r[1]||(r[1]=[H("返回",-1)])]),en:M(()=>[...r[2]||(r[2]=[H("Back",-1)])]),_:1})]),r[3]||(r[3]=t("span",{class:"icon"},"←",-1))]),_:1})]),r[4]||(r[4]=t("div",{class:"w-1/3 text-center"},[t("h1",{class:"text-2xl md:text-3xl font-bold"},"行動詳情")],-1)),r[5]||(r[5]=t("div",{class:"w-1/3"},null,-1))])]),t("main",ut,[l.value?(n(),o("div",_t,[t("div",mt,[t("div",vt,[r[6]||(r[6]=t("img",{src:K,alt:"Action Image",class:"w-16 h-16 rounded-lg object-cover"},null,-1)),t("div",ft,[t("h2",pt,m(l.value.title),1),t("p",yt,m(l.value.group),1)])]),t("div",xt,[t("div",null,[r[7]||(r[7]=t("span",{class:"font-semibold text-gray-700 text-sm"},"時間：",-1)),t("p",bt,m($(l.value.startTime,l.value.endTime)),1)]),t("div",null,[r[8]||(r[8]=t("span",{class:"font-semibold text-gray-700 text-sm"},"進度：",-1)),t("p",ht,m(l.value.progress)+"% ",1)]),t("div",null,[r[9]||(r[9]=t("span",{class:"font-semibold text-gray-700 text-sm"},"描述：",-1)),t("p",wt,m(l.value.intro||"暫無描述"),1)])])]),t("div",kt,[r[11]||(r[11]=t("div",{class:"flex justify-between items-center mb-6"},[t("h3",{class:"text-xl font-bold text-gray-800"},"專案甘特圖")],-1)),l.value.startTime&&l.value.endTime?(n(),re(it,{key:0,"start-time":parseInt(l.value.startTime),"end-time":parseInt(l.value.endTime),phases:k.value,posts:l.value.post||[],avatar:"student.png"},null,8,["start-time","end-time","phases","posts"])):(n(),o("div",Dt,[...r[10]||(r[10]=[t("i",{class:"fas fa-chart-bar text-4xl text-gray-300 mb-4"},null,-1),t("p",{class:"text-lg mb-2"},"時間資訊不完整",-1),t("p",{class:"text-sm"},"無法顯示甘特圖",-1)])]))])])):(n(),o("div",Tt,[...r[12]||(r[12]=[t("div",{class:"text-gray-500"},"載入中...",-1)])]))])])],32)}}},At=W(St,[["__scopeId","data-v-a00e14c5"]]);export{At as default};
