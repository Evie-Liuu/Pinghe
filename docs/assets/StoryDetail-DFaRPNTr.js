import{_ as ae,a as ne,b as ie,c as oe,d as re,e as ue,f as de,g as ge,h as ve,i as _e,j as ce,k as me,l as pe,m as be,n as fe,o as xe,p as he,q as ke,r as ye,s as we,t as Ce,u as Le,v as Te,w as Se,x as Be,y as Ee,z as Me,A as Ue,B as $e,C as De,D as Ie,E as He}from"./平和國小_mobile_Example-xpo9UaZU.js";import{B as Ae,u as Re,r as g,c as $,D as ze,C as Oe,a as n,o as i,b as t,d,f as D,g as I,h as O,i as je,s as Ne,q as u,t as b,F as L,p as T,n as v,e as S,v as B,A as Pe}from"./index-C9pJ2nNV.js";import{i as Ve,u as Fe}from"./useDateFormat-CIG6JLk8.js";import{s as j}from"./SDGs_goal-BU-5yG0n.js";import{C as Ge}from"./CJKSub-Cb5fPA5n.js";import{N as qe,n as Je,m as We,u as Ke,i as Qe,a as Xe,b as Ye,c as Ze,E as et}from"./index-Du7Lk2eC.js";var tt=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,st=qe.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:m}){return["img",We(this.options.HTMLAttributes,m)]},addCommands(){return{setImage:m=>({commands:f})=>f.insertContent({type:this.name,attrs:m})}},addInputRules(){return[Je({find:tt,type:this.type,getAttributes:m=>{const[,,f,k,E]=m;return{src:k,alt:f,title:E}}})]}}),lt=st;const at={class:"pt-25 w-full z-10 shadow-md bg-header text-rice-500"},nt={class:"container mx-auto flex items-center p-4"},it={class:"w-1/3"},ot={class:"text"},rt={class:"max-w-4xl mx-auto p-4 pt-10 text-[1.2rem]"},ut={key:0,class:"animate-fade-in-up flex flex-col gap-8"},dt={class:"relative z-10 text-white"},gt={class:"text-4xl font-bold mb-4"},vt={class:"mb-2 text-lg"},_t={class:"flex flex-wrap gap-2 mt-2"},ct={class:"flex flex-col gap-4 items-start"},mt={class:"self-end flex gap-2"},pt=["innerHTML"],bt={key:1,class:"w-full"},ft={key:0,class:"border p-2 flex gap-2 rounded-t-md"},xt={class:"my-20"},ht={class:"flex flex-col gap-4 mb-6 text-black"},kt={class:"font-bold"},yt={class:"text-gray-800"},wt={class:"flex items-center justify-end mt-2"},Ct=["onClick"],Lt={class:"ml-1"},Tt={key:1},St={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 text-black"},Bt={class:"bg-white p-6 rounded-md max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Et={class:"mb-4"},Mt={class:"relative flex flex-wrap items-center"},Ut={key:0,class:"absolute right-2 text-red-500"},$t={key:0,class:"text-red-500 text-sm mt-1"},Dt={class:"mb-4"},It={class:"mb-4"},Ht=["value"],At={class:"mb-4"},Rt={class:"relative"},zt=["innerHTML"],Ot=["onClick"],jt=["placeholder"],Nt={key:0,class:"absolute right-2 text-red-500"},Pt=["onClick","innerHTML"],Vt={key:0,class:"px-3 py-2 text-gray-500"},Ft={key:1,class:"text-red-500 text-sm mt-1"},Gt={class:"mb-4"},qt={__name:"StoryDetail",props:{id:String},setup(m){const f=m,k=Pe("handleAppScroll"),{formatDate:E}=Fe(),{isTeacher:y}=Re(),o=g(Ve.find(s=>s.id===parseInt(f.id))),p=g(!1),N=$(()=>{if(!o.value)return{};const s=o.value.img_url||"Background_2.png";try{return{backgroundImage:`url(${new URL(Object.assign({"../assets/images/Background_1.png":He,"../assets/images/Background_1_B.png":Ie,"../assets/images/Background_1_F.png":De,"../assets/images/Background_2.png":$e,"../assets/images/Background_Example.png":Ue,"../assets/images/Bar_Selected.png":Me,"../assets/images/Bar_Unselected.png":Ee,"../assets/images/LoadingTrain.png":Be,"../assets/images/Logo.gif":Se,"../assets/images/MainPage_Background.png":Te,"../assets/images/MainPage_Background.webp":Le,"../assets/images/MainPage_Background_T.png":Ce,"../assets/images/MainPage_Example.png":we,"../assets/images/MainPage_Pic.png":ye,"../assets/images/MainPage_Pic.webp":ke,"../assets/images/Title.png":he,"../assets/images/Train_Long.png":xe,"../assets/images/Train_Long_Full.png":fe,"../assets/images/Train_Smoke.gif":be,"../assets/images/Train_Smoke_W.gif":pe,"../assets/images/figure1.png":me,"../assets/images/figure2.png":ce,"../assets/images/figure3.png":_e,"../assets/images/figure4.png":ve,"../assets/images/figure5.png":ge,"../assets/images/lightBulb.png":de,"../assets/images/lightBulb2.png":ue,"../assets/images/logo.png":re,"../assets/images/logo_BW.png":oe,"../assets/images/story_bg.png":ie,"../assets/images/student.png":ne,"../assets/images/平和國小_mobile_Example.png":ae})[`../assets/images/${s}`],import.meta.url).href})`}}catch{return{backgroundImage:`url(${new URL(""+new URL("Background_2-C9DmGNh3.png",import.meta.url).href,import.meta.url).href})`}}}),a=Ke({content:"",extensions:[Qe,Xe,Ye.configure({nested:!0}),lt,Ze]});ze(()=>{a.value&&a.value.destroy()});const P=()=>{a.value&&a.value.commands.setContent(o.value.content||""),p.value=!0},V=()=>{a.value&&(o.value.content=a.value.getHTML()),p.value=!1,console.log("內容已儲存:",a.value.getJSON()),alert("內容已儲存！")},F=()=>{a.value&&a.value.commands.setContent(o.value.content||""),p.value=!1},G=()=>{navigator.share?navigator.share({title:o.value.title,text:o.value.intro,url:window.location.href}).catch(console.error):(navigator.clipboard.writeText(window.location.href),alert("連結已複製到剪貼簿！"))},M={author_uuid:"0",author:"我"},x=g(""),q=()=>{x.value.trim()!==""&&(o.value.comment.unshift({uuid:Date.now(),author_uuid:M.author_uuid,author:M.author,time:Date.now(),delete_time:null,text:x.value,likes:0,liked:!1}),x.value="")},J=s=>{const e=o.value.comment.find(c=>c.uuid===s);e&&(e.liked?e.likes--:e.likes++,e.liked=!e.liked)},w=g(!1),r=g({...o.value}),h=g(""),C=g(!1),H=g(null),U=j.filter(s=>s.value!==0),A=$(()=>U.filter(s=>r.value.types.includes(s.value))),R=$(()=>h.value?U.filter(s=>s.title.toLowerCase().includes(h.value.toLowerCase())&&!r.value.types.includes(s.value)):U.filter(s=>!r.value.types.includes(s.value)));Oe(H,()=>{C.value=!1});const _=g({title:!1,tags:!1}),W=()=>{r.value={...o.value},w.value=!0},K=()=>{w.value=!1},Q=()=>{let s=!1;r.value.title.trim()||(_.value.title=!0,s=!0),r.value.types.length===0&&(_.value.tags=!0,s=!0),!s&&(o.value.title=r.value.title,o.value.intro=r.value.intro,o.value.time=r.value.time,o.value.types=r.value.types,o.value.img_url=r.value.img_url,w.value=!1)},X=s=>{const e=s.target.files[0];e&&(r.value.img_url=e.name)},Y=s=>{const e=new Date(s.target.value);r.value.time=Math.floor(e.getTime()/1e3)},Z=s=>{r.value.types.includes(s.value)||r.value.types.push(s.value),h.value="",C.value=!1},ee=s=>{const e=r.value.types.indexOf(s);e!==-1&&r.value.types.splice(e,1)},te=()=>{},se=s=>{const e=s.target.files[0];if(e&&a.value){const c=URL.createObjectURL(e);a.value.chain().focus().setImage({src:c}).run()}s.target.value=""},le=s=>{const e=s.target.files[0];if(e&&a.value){const c=URL.createObjectURL(e);a.value.chain().focus().extendMarkRange("link").setLink({href:c}).insertContent(e.name).run()}s.target.value=""};return(s,e)=>{const c=je("router-link");return i(),n("div",{class:"page-background content-scroller",onScroll:e[12]||(e[12]=(...l)=>u(k)&&u(k)(...l))},[t("header",at,[t("div",nt,[t("div",it,[D(c,{to:"/story",class:"back-home-btn"},{default:I(()=>[t("span",ot,[D(Ge,{align:"center"},{zh:I(()=>[...e[13]||(e[13]=[O("回上頁",-1)])]),en:I(()=>[...e[14]||(e[14]=[O("Return",-1)])]),_:1})]),e[15]||(e[15]=t("span",{class:"icon"},"←",-1))]),_:1})]),e[16]||(e[16]=t("div",{class:"w-1/3 text-center"},null,-1)),e[17]||(e[17]=t("div",{class:"w-1/3"},null,-1))])]),t("main",rt,[o.value?(i(),n("section",ut,[t("div",{style:Ne(N.value),class:"relative bg-cover bg-center bg-opacity-70 p-7 rounded-md md:h-80 grid grid-cols-1 content-end overflow-hidden"},[e[18]||(e[18]=t("div",{class:"absolute inset-0 bg-black/40"},null,-1)),u(y)?(i(),n("button",{key:0,onClick:W,class:"absolute top-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 z-20"}," 編輯 ")):d("",!0),t("div",dt,[t("h1",gt,b(o.value.title),1),t("p",vt,b(o.value.intro),1),t("small",null,b(u(E)(o.value.time*1e3)),1),t("div",_t,[(i(!0),n(L,null,T(o.value.types,l=>(i(),n("span",{key:l,class:"px-3 py-1 text-sm rounded-full bg-blue-100 text-blue-800"},b(u(j)[l].title.replace(/<br\s*\/?>/gi,"")),1))),128))])])],4),t("section",ct,[t("div",mt,[!p.value&&u(y)?(i(),n("button",{key:0,onClick:P,class:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600"}," 編輯內容 ")):d("",!0),p.value&&u(y)?(i(),n("button",{key:1,onClick:V,class:"bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600"}," 儲存 ")):d("",!0),p.value&&u(y)?(i(),n("button",{key:2,onClick:F,class:"bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600"}," 取消 ")):d("",!0),t("button",{onClick:G,class:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600"}," 分享 ")]),p.value?(i(),n("div",bt,[u(a)?(i(),n("div",ft,[t("button",{onClick:e[0]||(e[0]=l=>u(a).chain().focus().toggleHeading({level:1}).run()),class:v([{"is-active":u(a).isActive("heading",{level:1})},"p-2 rounded hover:bg-blue-200"]),title:"標題 1"}," H1 ",2),t("button",{onClick:e[1]||(e[1]=l=>u(a).chain().focus().toggleHeading({level:2}).run()),class:v([{"is-active":u(a).isActive("heading",{level:2})},"p-2 rounded hover:bg-blue-200"]),title:"標題 2"}," H2 ",2),t("button",{onClick:e[2]||(e[2]=l=>u(a).chain().focus().toggleHeading({level:3}).run()),class:v([{"is-active":u(a).isActive("heading",{level:3})},"p-2 rounded hover:bg-blue-200"]),title:"標題 3"}," H3 ",2),t("button",{onClick:e[3]||(e[3]=l=>u(a).chain().focus().toggleTaskList().run()),class:v([{"bg-blue-200":u(a).isActive("taskList")},"p-2 rounded hover:bg-blue-200"]),title:"待辦清單"},[...e[19]||(e[19]=[t("i",{class:"fa-solid fa-list-check"},null,-1)])],2),t("button",{onClick:e[4]||(e[4]=l=>u(a).chain().focus().toggleBulletList().run()),class:v([{"bg-blue-200":u(a).isActive("bulletList")},"p-2 rounded hover:bg-blue-200"]),title:"項目符號清單"},[...e[20]||(e[20]=[t("i",{class:"fa-solid fa-list-ul"},null,-1)])],2),t("button",{onClick:e[5]||(e[5]=l=>s.$refs.imageInput.click()),class:"p-2 rounded hover:bg-blue-200",title:"插入圖片"},[...e[21]||(e[21]=[t("i",{class:"fa-solid fa-image"},null,-1)])]),t("button",{onClick:e[6]||(e[6]=l=>s.$refs.fileInput.click()),class:"p-2 rounded hover:bg-blue-200",title:"插入檔案"},[...e[22]||(e[22]=[t("i",{class:"fa-solid fa-paperclip"},null,-1)])]),t("input",{ref:"imageInput",type:"file",accept:"image/*",onChange:se,style:{display:"none"}},null,544),t("input",{ref:"fileInput",type:"file",onChange:le,style:{display:"none"}},null,544)])):d("",!0),D(u(et),{editor:u(a),class:"w-full prose max-w-none border-x border-b p-4 rounded-b-md overflow-hidden"},null,8,["editor"])])):(i(),n("div",{key:0,class:"prose max-w-none",innerHTML:o.value.content},null,8,pt))]),t("section",xt,[e[23]||(e[23]=t("h2",{class:"text-xl mb-4"},"留言板",-1)),t("div",ht,[(i(!0),n(L,null,T(o.value.comment,l=>(i(),n("div",{key:l.uuid,class:v(["p-4 rounded-md",l.author_uuid===M.author_uuid?"bg-green-100":"bg-gray-100"])},[t("p",kt,b(l.author),1),t("p",yt,b(l.text),1),t("div",wt,[t("button",{onClick:z=>J(l.uuid),class:"text-gray-500 hover:text-red-500"},[t("i",{class:v(["fa-heart",l.liked?"fa-solid text-red-500":"fa-regular"])},null,2),t("span",Lt,b(l.likes),1)],8,Ct)])],2))),128))]),t("div",null,[S(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=l=>x.value=l),class:"w-full p-2 border rounded-md",rows:"3",placeholder:"在這裡寫下你的留言..."},null,512),[[B,x.value]]),t("button",{onClick:q,class:"mt-2 bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600"}," 發布留言 ")])])])):(i(),n("div",Tt,[...e[24]||(e[24]=[t("p",null,"找不到這篇故事。",-1)])]))]),w.value?(i(),n("div",St,[t("div",Bt,[e[33]||(e[33]=t("h2",{class:"text-xl mb-4"},"編輯故事",-1)),t("div",Et,[e[26]||(e[26]=t("label",{class:"block text-lg font-medium mb-2"},"標題*",-1)),t("div",Mt,[S(t("input",{type:"text","onUpdate:modelValue":e[8]||(e[8]=l=>r.value.title=l),class:v(["w-full p-2 border border-gray-300 rounded-md",{"border-red-500":_.value.title}])},null,2),[[B,r.value.title]]),_.value.title?(i(),n("div",Ut,[...e[25]||(e[25]=[t("i",{class:"fa-solid fa-circle-exclamation"},null,-1)])])):d("",!0)]),_.value.title?(i(),n("p",$t," 請輸入標題 ")):d("",!0)]),t("div",Dt,[e[27]||(e[27]=t("label",{class:"block text-lg font-medium mb-2"},"介紹",-1)),S(t("input",{type:"text","onUpdate:modelValue":e[9]||(e[9]=l=>r.value.intro=l),class:"w-full p-2 border border-gray-300 rounded-md"},null,512),[[B,r.value.intro]])]),t("div",It,[e[28]||(e[28]=t("label",{class:"block text-lg font-medium mb-2"},"時間",-1)),t("input",{type:"date",value:r.value.time?new Date(r.value.time*1e3).toISOString().split("T")[0]:"",onInput:Y,class:"w-full p-2 border border-gray-300 rounded-md"},null,40,Ht)]),t("div",At,[e[30]||(e[30]=t("label",{class:"block text-lg font-medium mb-2"},"SDGs標籤*",-1)),t("div",Rt,[t("div",{class:v(["relative flex flex-wrap items-center gap-1 p-2 border border-gray-300 rounded-md min-h-[2.5rem]",{"border-red-500":_.value.tags}])},[(i(!0),n(L,null,T(A.value,l=>(i(),n("span",{key:l.value,class:"inline-flex items-center px-2 py-1 text-sm bg-blue-500 text-white rounded-full"},[t("span",{innerHTML:l.title},null,8,zt),t("button",{onClick:z=>ee(l.value),class:"ml-1 text-white hover:text-gray-200"}," × ",8,Ot)]))),128)),S(t("input",{type:"text","onUpdate:modelValue":e[10]||(e[10]=l=>h.value=l),onFocus:e[11]||(e[11]=l=>C.value=!0),onInput:te,class:"flex-1 min-w-0 outline-none bg-transparent",placeholder:A.value.length===0?"搜尋SDGs標籤...":""},null,40,jt),[[B,h.value]]),_.value.tags?(i(),n("div",Nt,[...e[29]||(e[29]=[t("i",{class:"fa-solid fa-circle-exclamation"},null,-1)])])):d("",!0)],2),C.value?(i(),n("div",{key:0,ref_key:"editDropdown",ref:H,class:"absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto mt-1"},[(i(!0),n(L,null,T(R.value,l=>(i(),n("div",{key:l.value,onClick:z=>Z(l),class:"px-3 py-2 hover:bg-orange-300 cursor-pointer",innerHTML:l.title},null,8,Pt))),128)),R.value.length===0?(i(),n("div",Vt," 無匹配的標籤 ")):d("",!0)],512)):d("",!0),_.value.tags?(i(),n("p",Ft," 請至少選擇一個SDGs標籤 ")):d("",!0)])]),t("div",Gt,[e[31]||(e[31]=t("label",{class:"block text-lg font-medium mb-2"},"背景圖片",-1)),t("input",{type:"file",onChange:X,accept:"image/*",class:"w-full p-2 border border-gray-300 rounded-md"},null,32),e[32]||(e[32]=t("p",{class:"text-sm text-gray-500 mt-1"}," 選擇新圖片上傳，將替換現有背景圖片。 ",-1))]),t("div",{class:"flex justify-end gap-2"},[t("button",{onClick:K,class:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600"}," 取消 "),t("button",{onClick:Q,class:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600"}," 儲存 ")])])])):d("",!0)],32)}}},Zt=Ae(qt,[["__scopeId","data-v-dc60b6da"]]);export{Zt as default};
