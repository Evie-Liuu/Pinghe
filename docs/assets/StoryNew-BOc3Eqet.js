import{C as j,u as q,r as _,c as D,D as J,E as K,a as r,o as n,b as s,f as C,g as $,h as M,i as R,e as x,d as u,v as w,n as m,F as E,p as I,q as v,l as W,j as Z,t as L}from"./index-BdfhtmlJ.js";import{C as P}from"./CJKSub-BfqnPf4a.js";import{u as Q,i as X,a as ee,b as te,E as se}from"./index-Dzb-g-gX.js";import{s as ae}from"./SDGs_goal-BU-5yG0n.js";function le(){return{formatISO:(p,d=!1)=>{const t=new Date(p*1e3);console.log(t);const b=d?t.getUTCFullYear():t.getFullYear(),c=String((d?t.getUTCMonth():t.getMonth())+1).padStart(2,"0"),f=String(d?t.getUTCDate():t.getDate()).padStart(2,"0"),y=String(d?t.getUTCHours():t.getHours()).padStart(2,"0"),h=String(d?t.getUTCMinutes():t.getMinutes()).padStart(2,"0"),k=String(d?t.getUTCSeconds():t.getSeconds()).padStart(2,"0");return`${b}-${c}-${f}T${y}:${h}:${k}${d?"Z":""}`},formatTimestamp:p=>Math.floor(new Date(p).getTime())}}const oe={class:"page-background content-scroller"},re={class:"pt-25 w-full z-10 shadow-md bg-header text-rice-500"},ne={class:"container mx-auto flex items-center p-4"},ie={class:"w-1/3"},de={class:"text"},ue={class:"max-w-4xl mx-auto p-4 pt-10 text-[1.2rem]"},me={class:"flex flex-col gap-4"},ce={key:0,class:"text-red-500 text-sm mt-1"},ge={class:"mt-2 relative"},ve={class:"relative"},fe=["onClick"],pe=["placeholder"],be=["onClick"],_e={key:0,class:"px-3 py-2 text-gray-500"},xe={key:0,class:"text-red-500 text-sm mt-1"},we={key:0,class:"text-red-500 text-sm mt-1"},ye={class:"mt-1 flex gap-2 items-center"},he={key:0,class:"text-red-500 text-sm mt-1"},ke={key:1,class:"text-red-500 text-sm mt-1"},Se={__name:"StoryNew",setup(V){const{user:T}=q(),p=Z(),{formatISO:d}=le(),t=_({title:"",content:"",intro:"",start_time:null,end_time:null,duration_value:1,duration_unit:"day",sdgs_goals:[],author_id:T.value.id,post_type:"general"}),b=ae.filter(l=>l.value!==0).map(l=>({...l,title:l.title.replace(/<br\s*\/?>/g,"")})),c=_(""),f=_(!1),y=_(null),h=D(()=>c.value?b.filter(l=>l.title.toLowerCase().includes(c.value.toLowerCase())&&!t.value.sdgs_goals.includes(l.value)):b.filter(l=>!t.value.sdgs_goals.includes(l.value))),k=D(()=>b.filter(l=>t.value.sdgs_goals.includes(l.value)));D(()=>{if(!t.value.start_time||!t.value.duration_value)return"";const l=new Date(t.value.start_time),e=new Date(l);switch(t.value.duration_unit){case"day":e.setDate(e.getDate()+parseInt(t.value.duration_value));break;case"week":e.setDate(e.getDate()+parseInt(t.value.duration_value)*7);break;case"month":e.setMonth(e.getMonth()+parseInt(t.value.duration_value));break}return e.toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})});const N=l=>{t.value.sdgs_goals.includes(l.value)||t.value.sdgs_goals.push(l.value),c.value="",f.value=!1},F=l=>{const e=t.value.sdgs_goals.indexOf(l);e!==-1&&t.value.sdgs_goals.splice(e,1)},O=()=>{},U=(l,e)=>{if(!t.value.start_time){alert("請先選擇開始時間");return}const g=new Date(t.value.start_time),a=new Date(g);switch(e){case"day":a.setDate(a.getDate()+l);break;case"week":a.setDate(a.getDate()+l*7);break;case"month":a.setMonth(a.getMonth()+l);break}const S=a.getFullYear(),H=String(a.getMonth()+1).padStart(2,"0"),A=String(a.getDate()).padStart(2,"0"),G=String(a.getHours()).padStart(2,"0"),Y=String(a.getMinutes()).padStart(2,"0");t.value.end_time=`${S}-${H}-${A}T${G}:${Y}`},z=()=>{if(!t.value.start_time){alert("請先選擇開始時間");return}U(1,"day")},o=_({title:!1,tags:!1,content:!1,start_time:!1,end_time:!1}),i=Q({content:"<p>開始寫下你的故事...</p>",extensions:[X,ee,te.configure({nested:!0})]});J(y,()=>{f.value=!1}),K(()=>{i.value&&i.value.destroy()});const B=()=>{o.value={title:!1,tags:!1,content:!1,start_time:!1,end_time:!1},i.value&&(t.value.content=i.value.getHTML());let l=!1;if(t.value.title.trim()||(o.value.title=!0,l=!0),t.value.sdgs_goals.length===0&&(o.value.tags=!0,l=!0),i.value.isEmpty&&(o.value.content=!0,l=!0),t.value.start_time||(o.value.start_time=!0,l=!0),t.value.end_time&&t.value.start_time){const g=new Date(t.value.start_time);new Date(t.value.end_time)<=g&&(o.value.end_time=!0,l=!0)}if(l)return;const e={...t.value};e.sdgs_goals=[...t.value.sdgs_goals],e.start_time&&(e.start_time=d(new Date(e.start_time).getTime()/1e3)),e.end_time&&(e.end_time=d(new Date(e.end_time).getTime()/1e3)),console.log("New Story Data:",e);try{W.createShowcase(e)}catch(g){console.error("Error saving story:",g)}p.push("/story")};return(l,e)=>{const g=R("router-link");return n(),r("div",oe,[s("header",re,[s("div",ne,[s("div",ie,[C(g,{to:"/story",class:"back-home-btn"},{default:$(()=>[s("span",de,[C(P,{align:"left"},{zh:$(()=>[...e[8]||(e[8]=[M("取消",-1)])]),en:$(()=>[...e[9]||(e[9]=[M("Cancel",-1)])]),_:1})]),e[10]||(e[10]=s("span",{class:"icon"},"←",-1))]),_:1})]),e[11]||(e[11]=s("div",{class:"w-1/3 text-center"},[s("h1",{class:"text-2xl md:text-3xl font-bold"},"建立故事")],-1)),e[12]||(e[12]=s("div",{class:"w-1/3"},null,-1))])]),s("main",ue,[s("div",me,[s("div",null,[e[13]||(e[13]=s("label",{for:"title",class:"block text-lg font-medium"},"標題*",-1)),x(s("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>t.value.title=a),id:"title",class:m(["mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":o.value.title}])},null,2),[[w,t.value.title]]),o.value.title?(n(),r("p",ce," 請輸入標題 ")):u("",!0)]),s("div",null,[e[14]||(e[14]=s("label",{class:"block text-lg font-medium"},"SDGs標籤*",-1)),s("div",ge,[s("div",ve,[s("div",{class:m(["flex flex-wrap items-center gap-1 p-2 border border-gray-300 rounded-md shadow-sm focus-within:ring-indigo-500 focus-within:border-indigo-500 min-h-[2.5rem]",{"border-red-500":o.value.tags}])},[(n(!0),r(E,null,I(k.value,a=>(n(),r("span",{key:a.value,class:"inline-flex items-center px-2 py-1 text-sm bg-blue-500 text-white rounded-full"},[s("span",null,L(a.title),1),s("button",{onClick:S=>F(a.value),class:"ml-1 text-white hover:text-gray-200"}," × ",8,fe)]))),128)),x(s("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),onFocus:e[2]||(e[2]=a=>f.value=!0),onInput:O,class:"flex-1 min-w-0 outline-none bg-transparent",placeholder:k.value.length===0?"搜尋SDGs標籤...":"",ref:"searchInput"},null,40,pe),[[w,c.value]])],2),f.value?(n(),r("div",{key:0,ref_key:"dropdown",ref:y,class:"absolute z-10 w-full bg-pblue-200 border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto mt-1"},[(n(!0),r(E,null,I(h.value,a=>(n(),r("div",{key:a.value,onClick:S=>N(a),class:"px-3 py-2 hover:bg-orange-300 cursor-pointer"},L(a.title),9,be))),128)),h.value.length===0?(n(),r("div",_e," 無匹配的標籤 ")):u("",!0)],512)):u("",!0)]),o.value.tags?(n(),r("p",xe," 請至少選擇一個SDGs標籤 ")):u("",!0)])]),s("div",null,[e[15]||(e[15]=s("label",{for:"intro",class:"block text-lg font-medium"},"簡介",-1)),x(s("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=a=>t.value.intro=a),id:"intro",class:"mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[w,t.value.intro]])]),s("div",null,[e[16]||(e[16]=s("label",{for:"start_time",class:"block text-lg font-medium"},"時間*",-1)),x(s("input",{type:"datetime-local","onUpdate:modelValue":e[4]||(e[4]=a=>t.value.start_time=a),id:"start_time",class:m(["mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":o.value.start_time}])},null,2),[[w,t.value.start_time]]),o.value.start_time?(n(),r("p",we," 請選擇開始時間 ")):u("",!0)]),s("div",null,[s("div",ye,[s("button",{onClick:z,class:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600"}," 加入結束時間 "),x(s("input",{type:"datetime-local","onUpdate:modelValue":e[5]||(e[5]=a=>t.value.end_time=a),id:"end_time",class:m(["flex-1 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":o.value.end_time}]),readonly:""},null,2),[[w,t.value.end_time]])]),o.value.end_time?(n(),r("p",he," 請新增有效的結束時間 ")):u("",!0)]),s("div",null,[e[19]||(e[19]=s("label",{class:"block text-lg font-medium"},"內容*",-1)),v(i)?(n(),r("div",{key:0,class:m(["border p-2 flex gap-2 rounded-t-md mt-1",{"border-red-500":o.value.content}])},[s("button",{onClick:e[6]||(e[6]=a=>v(i).chain().focus().toggleTaskList().run()),class:m([{"bg-blue-200":v(i).isActive("taskList")},"p-2 rounded hover:bg-blue-200"]),title:"待辦清單"},[...e[17]||(e[17]=[s("i",{class:"fa-solid fa-list-check"},null,-1)])],2),s("button",{onClick:e[7]||(e[7]=a=>v(i).chain().focus().toggleBulletList().run()),class:m([{"bg-blue-200":v(i).isActive("bulletList")},"p-2 rounded hover:bg-blue-200"]),title:"項目符號清單"},[...e[18]||(e[18]=[s("i",{class:"fa-solid fa-list-ul"},null,-1)])],2)],2)):u("",!0),C(v(se),{editor:v(i),class:m(["w-full prose max-w-none border-x border-b p-4 rounded-b-md bg-white text-black",{"border-red-500":o.value.content}])},null,8,["editor","class"]),o.value.content?(n(),r("p",ke," 請輸入內容 ")):u("",!0)]),s("div",{class:"self-end"},[s("button",{onClick:B,class:"bg-green-500 text-white px-6 py-2 rounded-md hover:bg-green-600"}," 儲存 ")])])])])}}},Me=j(Se,[["__scopeId","data-v-92f5a07d"]]);export{Me as default};
