import{_ as te,a as se}from"./lightBulb2-0S6W8jUj.js";import{z as V,r as E,C as re,c,D as ae,a as i,o,b as r,t as _,n as I,e as ne,k as oe,F as x,l as w,p as h,d as B,E as ie,G as le,f as z,g as A,h as F,i as ge,x as de,m as L,y as ue}from"./index-B8XgtHK5.js";import{C as ce}from"./CJKSub-XmbfC7Yg.js";import{_ as me,a as _e,b as ve,c as pe,d as fe,e as ye,f as be,g as xe,h as he,i as we,j as ke,k as Te,l as De,m as Se,n as $e,o as Ce,p as Me,q as Ie,r as Be,s as Ae,t as Ee,u as Re,v as je,w as Ne,x as We,y as Oe,z as Pe,A as ze,B as Fe,C as Le,D as Ve,E as He}from"./平和國小_mobile_Example-Bsr5Md9p.js";const Ue={class:"gantt-header bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200 relative shadow-sm",style:{"grid-column":"1 / -1","grid-row":"1"}},Ye={class:"absolute top-2 left-2 text-xs text-gray-700 bg-white bg-opacity-90 px-2 py-1 rounded-md shadow-sm z-10 font-medium"},qe={class:"w-1/2 p-2 font-medium text-center text-xs bg-gray-50 border-r border-gray-200 flex flex-col items-center justify-center gap-1"},Ge={class:"phase-headers",style:{"grid-column":"2 / -1","grid-row":"1",display:"grid","grid-template-columns":"repeat(auto-fit, minmax(0, 1fr))"}},Ke={key:0,class:"flex items-center justify-center h-32 text-gray-500 bg-gray-50"},Xe={key:1,class:"flex items-center justify-center h-32 text-gray-500 bg-gray-50"},Je={key:0,class:"post-indicator absolute right-2 top-1/2 transform -translate-y-1/2 z-10"},Qe=["src"],Ze=["title"],et={__name:"GanttChart",props:{startTime:{type:Number,required:!0,validator:u=>u>0},endTime:{type:Number,required:!0,validator:u=>u>0},phases:{type:Array,default:()=>[],validator:u=>Array.isArray(u)&&u.every(v=>v&&typeof v.id<"u"&&typeof v.name=="string")},posts:{type:Array,default:()=>[],validator:u=>Array.isArray(u)&&u.every(v=>v&&typeof v.time<"u")},avatar:{type:String,default:""}},emits:["update:scrollTime","phase-click","day-click"],setup(u,{emit:v}){const l=u,g=v,b=E("week"),k=re(null),T=E(l.startTime);function $(t){return t?new URL(Object.assign({"../assets/images/Background_1.png":He,"../assets/images/Background_1_B.png":Ve,"../assets/images/Background_1_F.png":Le,"../assets/images/Background_2.png":Fe,"../assets/images/Background_Example.png":ze,"../assets/images/Bar_Selected.png":Pe,"../assets/images/Bar_Unselected.png":Oe,"../assets/images/LoadingTrain.png":We,"../assets/images/Logo.gif":Ne,"../assets/images/MainPage_Background.png":je,"../assets/images/MainPage_Background.webp":Re,"../assets/images/MainPage_Background_T.png":Ee,"../assets/images/MainPage_Example.png":Ae,"../assets/images/MainPage_Pic.png":Be,"../assets/images/MainPage_Pic.webp":Ie,"../assets/images/Title.png":Me,"../assets/images/Train_Long.png":Ce,"../assets/images/Train_Long_Full.png":$e,"../assets/images/Train_Smoke.gif":Se,"../assets/images/Train_Smoke_W.gif":De,"../assets/images/figure1.png":Te,"../assets/images/figure2.png":ke,"../assets/images/figure3.png":we,"../assets/images/figure4.png":he,"../assets/images/figure5.png":xe,"../assets/images/lightBulb.png":be,"../assets/images/lightBulb2.png":ye,"../assets/images/logo.png":fe,"../assets/images/logo_BW.png":pe,"../assets/images/story_bg.png":ve,"../assets/images/student.png":_e,"../assets/images/平和國小_mobile_Example.png":me})[`../assets/images/${t}`],import.meta.url).href:""}const m=c(()=>l.startTime>0&&l.endTime>0&&l.endTime>l.startTime);c(()=>m.value?l.endTime-l.startTime:0);const n=new Map([["1-1","元旦"],["2-10","春節"],["2-11","春節"],["2-12","春節"],["4-4","兒童節"],["4-5","清明節"],["6-10","端午節"],["9-17","中秋節"],["10-10","國慶日"]]),p=c(()=>{if(typeof window<"u"){const t=window.innerWidth;if(t<480)return"w-16";if(t<640)return"w-18";if(t<768)return"w-20"}return"w-20"}),f=c(()=>{if(typeof window<"u"){const t=window.innerWidth;if(t<480)return b.value==="week"?32:24;if(t<768)return b.value==="week"?36:28}return b.value==="week"?42:32}),R=c(()=>{const e=`${p.value.replace("w-","")*.25}rem`,s=l.phases.length>0?` repeat(${l.phases.length}, 1fr)`:"";return`${e}${s}`}),H=c(()=>y.value.length===0?"auto":`repeat(${y.value.length}, ${f.value}px)`),y=c(()=>{if(!m.value)return[];try{const t=new Date(l.startTime*1e3),e=new Date(l.endTime*1e3);if(isNaN(t.getTime())||isNaN(e.getTime()))return console.warn("Invalid date range provided"),[];const s=[],a=new Date(t),d=3650;let D=0;for(;a<=e&&D<d;)s.push(new Date(a)),a.setDate(a.getDate()+1),D++;return D>=d&&console.warn("Date range too large, truncated to prevent performance issues"),s}catch(t){return console.error("Error generating days array:",t),[]}}),C=c(()=>{const t=new Map;return y.value.forEach(e=>{const s=new Date(e);s.setDate(e.getDate()-e.getDay());const a=s.toISOString().split("T")[0];t.has(a)||t.set(a,{weekStart:s,days:[]}),t.get(a).days.push(e)}),Array.from(t.values())}),M=c(()=>{const t=new Map;return y.value.forEach(e=>{const s=`${e.getFullYear()}-${e.getMonth()+1}`;t.has(s)||t.set(s,{monthStart:new Date(e.getFullYear(),e.getMonth(),1),days:[]}),t.get(s).days.push(e)}),Array.from(t.values())}),S=c(()=>{const t=new Map;try{l.posts.forEach(e=>{if(!e||typeof e.time>"u"){console.warn("Invalid post data:",e);return}const s=parseInt(e.time);if(isNaN(s)){console.warn("Invalid post time:",e.time);return}const a=new Date(s*1e3);if(isNaN(a.getTime())){console.warn("Invalid date from timestamp:",s);return}const d=a.toDateString();t.has(d)||t.set(d,[]),t.get(d).push(e)})}catch(e){console.error("Error processing posts:",e)}return Object.fromEntries(t)}),j=t=>t.getDate(),U=t=>`第${q(t)}週`,Y=t=>`${t.getMonth()+1}月`,q=t=>{const e=new Date(t.getFullYear(),0,1),s=Math.floor((t-e)/(1440*60*1e3));return Math.ceil((s+e.getDay()+1)/7)},N=t=>{const e=new Date(t*1e3);return y.value.findIndex(s=>s.toDateString()===e.toDateString())},G=t=>{let e=0;for(let s=0;s<t;s++)e+=C.value[s].days.length;return e},K=t=>{let e=0;for(let s=0;s<=t;s++)e+=C.value[s].days.length;return e},X=t=>{let e=0;for(let s=0;s<t;s++)e+=M.value[s].days.length;return e},J=t=>{let e=0;for(let s=0;s<=t;s++)e+=M.value[s].days.length;return e},W=t=>{if(!t.startTime||!t.endTime)return null;const e=N(t.startTime),s=N(t.endTime);if(e>=0&&s>=0&&e<=s){const a=e*f.value,d=(s-e+1)*f.value;return{top:`${a}px`,height:`${d}px`,left:"50%",transform:"translateX(-50%)"}}return null},O=t=>{const e=t.getDay();return e===0||e===6},Q=t=>{if(O(t))return!0;const e=t.getMonth()+1,s=t.getDate(),a=`${e}-${s}`;return n.has(a)},P=t=>{if(!t||typeof t.toDateString!="function")return!1;try{const e=t.toDateString();return S.value[e]&&S.value[e].length>0}catch(e){return console.warn("Error checking posts for day:",t,e),!1}},Z=()=>{if(!k.value)return;const t=k.value.scrollTop,e=Math.floor(t/f.value),s=y.value[e];if(s){const a=s.getTime()/1e3;T.value=a,g("update:scrollTime",a)}},ee=c(()=>new Date(T.value*1e3).toLocaleDateString("zh-TW",{year:"numeric",month:"long"}));return ae(()=>l.startTime,t=>{T.value=t}),(t,e)=>(o(),i("div",{class:"gantt-chart border border-gray-200 rounded-xl overflow-hidden bg-white shadow-sm",style:h({display:"grid",gridTemplateColumns:R.value,gridTemplateRows:"auto 1fr"})},[r("div",Ue,[r("div",Ye,_(ee.value),1),r("div",{class:I(`${p.value} border-r border-gray-200 flex`),style:{"grid-column":"1","grid-row":"1"}},[r("div",qe,[ne(r("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s),class:"text-xs border border-gray-300 rounded-md px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white shadow-sm","aria-label":"選擇時間單位"},[...e[1]||(e[1]=[r("option",{value:"week"},"週",-1),r("option",{value:"month"},"月",-1)])],512),[[oe,b.value]]),e[2]||(e[2]=r("span",{class:"text-xs text-gray-600 font-normal"},"時間軸",-1))]),e[3]||(e[3]=r("div",{class:"w-1/2 p-2 font-medium text-center text-xs bg-white border-r border-gray-200 flex items-center justify-center text-gray-700"}," 日期 ",-1))],2),r("div",Ge,[(o(!0),i(x,null,w(l.phases,(s,a)=>(o(),i("div",{key:s.id,class:I(["p-3 font-semibold text-center bg-gradient-to-b from-gray-50 to-gray-100 hover:from-gray-100 hover:to-gray-200 transition-all duration-200 text-gray-800",{"border-r border-gray-200":a<l.phases.length-1}])},_(s.name),3))),128))])]),m.value?y.value.length===0?(o(),i("div",Xe,[...e[5]||(e[5]=[r("div",{class:"text-center"},[r("p",{class:"text-sm"},"沒有可顯示的時間資料"),r("p",{class:"text-xs text-gray-400 mt-1"},"請檢查時間設定")],-1)])])):(o(),i("div",{key:2,class:"gantt-content h-150 overflow-y-auto",ref_key:"scrollContainer",ref:k,onScroll:Z,style:h({gridColumn:"1 / -1",gridRow:"2",display:"grid",gridTemplateColumns:R.value,gridTemplateRows:H.value})},[b.value==="week"?(o(),i(x,{key:0},[(o(!0),i(x,null,w(C.value,(s,a)=>(o(),i("div",{key:`week-header-${s.weekStart.toISOString()}`,class:"time-header-cell bg-gray-100 border-b border-gray-200 border-r border-gray-200 flex items-center justify-center text-xs font-semibold text-gray-700",style:h({gridColumn:"1",gridRow:`${G(a)+1} / ${K(a)+1}`,writingMode:"vertical-rl",textOrientation:"mixed"})},_(U(s.weekStart)),5))),128)),(o(!0),i(x,null,w(y.value,(s,a)=>(o(),i("div",{key:`week-day-${s.toISOString()}`,class:"day-cell border-b border-gray-200 flex flex-col items-center justify-center text-xs text-gray-700 font-medium",style:h({gridColumn:"1",gridRow:`${a+1}`})},_(j(s)),5))),128))],64)):b.value==="month"?(o(),i(x,{key:1},[(o(!0),i(x,null,w(M.value,(s,a)=>(o(),i("div",{key:`month-header-${s.monthStart.toISOString()}`,class:"time-header-cell bg-gray-100 border-b border-gray-200 border-r border-gray-200 flex items-center justify-center text-xs font-semibold text-gray-700",style:h({gridColumn:"1",gridRow:`${X(a)+1} / ${J(a)+1}`,writingMode:"vertical-rl",textOrientation:"mixed"})},_(Y(s.monthStart)),5))),128)),(o(!0),i(x,null,w(y.value,(s,a)=>(o(),i("div",{key:`month-day-${s.toISOString()}`,class:"day-cell border-b border-gray-200 flex flex-col items-center justify-center text-xs text-gray-700 font-medium",style:h({gridColumn:"1",gridRow:`${a+1}`})},_(j(s)),5))),128))],64)):B("",!0),(o(!0),i(x,null,w(l.phases,(s,a)=>(o(),i("div",{key:`phase-${s.id}`,class:"phase-column",style:{position:"relative"}},[(o(!0),i(x,null,w(y.value,(d,D)=>(o(),i("div",{key:`phase-${s.id}-day-${d.toISOString()}`,class:I(["phase-day-cell relative hover:bg-blue-50 transition-colors duration-200 border-b border-gray-200",{"bg-gray-100":Q(d),"bg-gray-50":O(d),"has-posts":P(d),"border-r border-gray-200":a<l.phases.length-1}]),style:h({gridColumn:`${a+2}`,gridRow:`${D+1}`})},[P(d)?(o(),i("div",Je,[u.avatar?(o(),i("img",{key:0,src:$(u.avatar),class:"w-6 h-6 rounded-full object-cover border-2 border-white shadow-md",alt:"使用者頭像"},null,8,Qe)):(o(),i("div",{key:1,class:"w-6 h-6 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white text-xs font-semibold shadow-md",title:`${S.value[d.toDateString()].length} 則貼文`},_(S.value[d.toDateString()].length),9,Ze))])):B("",!0)],6))),128)),W(s)?(o(),i("div",{key:0,class:"phase-line absolute w-1 bg-gradient-to-b from-blue-500 to-blue-600 opacity-75 rounded-full",style:h({...W(s),left:`${(a+1.5)*100}%`,transform:"translateX(-50%)"})},null,4)):B("",!0)]))),128))],36)):(o(),i("div",Ke,[...e[4]||(e[4]=[r("div",{class:"text-center"},[r("p",{class:"text-sm"},"無效的時間範圍"),r("p",{class:"text-xs text-gray-400 mt-1"},"請確認開始時間小於結束時間")],-1)])]))],4))}},tt=V(et,[["__scopeId","data-v-2fc692ef"]]),st={class:"relative z-5 pt-25 w-full shadow-md bg-header text-rice-500"},rt={class:"container mx-auto flex items-center p-4"},at={class:"w-1/3"},nt={class:"text"},ot={class:"max-w-7xl mx-auto p-6"},it={key:0,class:"space-y-6"},lt={class:"bg-white rounded-xl shadow-lg p-6"},gt={class:"flex items-center mb-4",style:{gap:"1rem"}},dt={class:"flex-1"},ut={class:"text-xl font-bold text-gray-800 mb-1"},ct={class:"text-gray-600 text-sm"},mt={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},_t={class:"text-gray-600 text-sm mt-1"},vt={class:"text-gray-600 text-sm mt-1"},pt={class:"text-gray-600 text-sm mt-1"},ft={class:"bg-white rounded-xl shadow-lg p-6"},yt={key:1,class:"text-center py-12 text-gray-500"},bt={key:1,class:"flex justify-center items-center h-64"},xt={__name:"ActionDetail",setup(u){const v=ie(),l=ue("handleAppScroll"),g=E(null),b=c(()=>parseInt(v.params.id)),k=c(()=>{if(!g.value||!g.value.stage)return[];const m=["#4CAF50","#2196F3","#FF9800","#9C27B0"];return Object.entries(g.value.stage).map(([n,p],f)=>({id:parseInt(n)+1,name:p.title,startTime:parseInt(p.startTime),endTime:parseInt(p.endTime),color:m[f%m.length]}))}),T=()=>{if(g.value=se.find(m=>m.id===b.value),!g.value){console.error("Action not found");return}},$=(m,n)=>{if(!m||!n)return"無";const p=new Date(m*1e3).toLocaleDateString("zh-TW"),f=new Date(n*1e3).toLocaleDateString("zh-TW");return`${p} ~ ${f}`};return le(()=>{T()}),(m,n)=>{const p=ge("router-link");return o(),i("div",{class:"page-background content-scroller",onScroll:n[0]||(n[0]=(...f)=>L(l)&&L(l)(...f))},[r("div",null,[r("header",st,[r("div",rt,[r("div",at,[z(p,{to:{name:"Actions"},class:"back-home-btn"},{default:A(()=>[r("span",nt,[z(ce,{align:"center"},{zh:A(()=>[...n[1]||(n[1]=[F("返回",-1)])]),en:A(()=>[...n[2]||(n[2]=[F("Back",-1)])]),_:1})]),n[3]||(n[3]=r("span",{class:"icon"},"←",-1))]),_:1})]),n[4]||(n[4]=r("div",{class:"w-1/3 text-center"},[r("h1",{class:"text-2xl md:text-3xl font-bold"},"行動詳情")],-1)),n[5]||(n[5]=r("div",{class:"w-1/3"},null,-1))])]),r("main",ot,[g.value?(o(),i("div",it,[r("div",lt,[r("div",gt,[n[6]||(n[6]=r("img",{src:te,alt:"Action Image",class:"w-16 h-16 rounded-lg object-cover"},null,-1)),r("div",dt,[r("h2",ut,_(g.value.title),1),r("p",ct,_(g.value.group),1)])]),r("div",mt,[r("div",null,[n[7]||(n[7]=r("span",{class:"font-semibold text-gray-700 text-sm"},"時間：",-1)),r("p",_t,_($(g.value.startTime,g.value.endTime)),1)]),r("div",null,[n[8]||(n[8]=r("span",{class:"font-semibold text-gray-700 text-sm"},"進度：",-1)),r("p",vt,_(g.value.progress)+"% ",1)]),r("div",null,[n[9]||(n[9]=r("span",{class:"font-semibold text-gray-700 text-sm"},"描述：",-1)),r("p",pt,_(g.value.intro||"暫無描述"),1)])])]),r("div",ft,[n[11]||(n[11]=r("h3",{class:"text-xl font-bold text-gray-800 mb-6"},"專案甘特圖",-1)),g.value.startTime&&g.value.endTime?(o(),de(tt,{key:0,"start-time":parseInt(g.value.startTime),"end-time":parseInt(g.value.endTime),phases:k.value,posts:g.value.post||[],avatar:"student.png"},null,8,["start-time","end-time","phases","posts"])):(o(),i("div",yt,[...n[10]||(n[10]=[r("i",{class:"fas fa-chart-bar text-4xl text-gray-300 mb-4"},null,-1),r("p",{class:"text-lg mb-2"},"時間資訊不完整",-1),r("p",{class:"text-sm"},"無法顯示甘特圖",-1)])]))])])):(o(),i("div",bt,[...n[12]||(n[12]=[r("div",{class:"text-gray-500"},"載入中...",-1)])]))])])],32)}}},Dt=V(xt,[["__scopeId","data-v-d589c3d5"]]);export{Dt as default};
