import{_ as K,a as U}from"./lightBulb2-t6vOkfMd.js";import{z as H,r as M,C as J,c as y,D as X,a as l,o,b as t,t as f,n as S,e as Q,k as Z,F as p,l as b,d as I,p as w,E as tt,G as et,f as E,g as A,h as W,i as st,x as rt,m as F,y as at}from"./index-BVZWTJiB.js";import{C as nt}from"./CJKSub-4z25wgAN.js";const ot={class:"gantt-chart border border-gray-200 rounded-xl overflow-hidden bg-white shadow-sm"},lt={class:"gantt-header flex bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200 relative shadow-sm"},it={class:"absolute top-2 left-2 text-xs text-gray-700 bg-white bg-opacity-90 px-2 py-1 rounded-md shadow-sm z-10 font-medium"},dt={class:"w-1/2 p-2 font-medium text-center text-xs bg-gray-50 border-r border-gray-200 flex flex-col items-center justify-center gap-1"},ct={class:"flex flex-1"},ut={key:0,class:"flex items-center justify-center h-32 text-gray-500 bg-gray-50"},mt={key:1,class:"flex items-center justify-center h-32 text-gray-500 bg-gray-50"},gt={key:0,class:"time-column"},ft={class:"flex w-full"},yt={class:"transform -rotate-90 whitespace-nowrap text-gray-700"},vt={class:"w-1/2"},xt={class:"text-xs text-gray-700 font-medium"},ht={key:1,class:"time-column"},pt={class:"flex w-full"},bt={class:"transform -rotate-90 whitespace-nowrap text-gray-700"},wt={class:"w-1/2"},_t={class:"text-xs text-gray-700 font-medium"},kt={class:"flex flex-1"},Dt={key:0,class:"post-indicator absolute right-2 top-1/2 transform -translate-y-1/2 z-10"},St=["src"],Tt=["title"],$t={__name:"GanttChart",props:{startTime:{type:Number,required:!0,validator:i=>i>0},endTime:{type:Number,required:!0,validator:i=>i>0},phases:{type:Array,default:()=>[],validator:i=>Array.isArray(i)&&i.every(v=>v&&typeof v.id<"u"&&typeof v.name=="string")},posts:{type:Array,default:()=>[],validator:i=>Array.isArray(i)&&i.every(v=>v&&typeof v.time<"u")},avatar:{type:String,default:""}},emits:["update:scrollTime","phase-click","day-click"],setup(i,{emit:v}){const m=i,d=v,h=M("week"),_=J(null),k=M(m.startTime),D=y(()=>m.startTime>0&&m.endTime>0&&m.endTime>m.startTime);y(()=>D.value?m.endTime-m.startTime:0);const x=new Map([["1-1","元旦"],["2-10","春節"],["2-11","春節"],["2-12","春節"],["4-4","兒童節"],["4-5","清明節"],["6-10","端午節"],["9-17","中秋節"],["10-10","國慶日"]]),a=y(()=>{if(typeof window<"u"){const e=window.innerWidth;if(e<480)return"w-16";if(e<640)return"w-18";if(e<768)return"w-20"}return"w-20"}),c=y(()=>{if(typeof window<"u"){const e=window.innerWidth;if(e<480)return h.value==="week"?32:24;if(e<768)return h.value==="week"?36:28}return h.value==="week"?42:32}),g=y(()=>{if(!D.value)return[];try{const e=new Date(m.startTime*1e3),s=new Date(m.endTime*1e3);if(isNaN(e.getTime())||isNaN(s.getTime()))return console.warn("Invalid date range provided"),[];const r=[],n=new Date(e),u=3650;let $=0;for(;n<=s&&$<u;)r.push(new Date(n)),n.setDate(n.getDate()+1),$++;return $>=u&&console.warn("Date range too large, truncated to prevent performance issues"),r}catch(e){return console.error("Error generating days array:",e),[]}}),B=y(()=>{const e=new Map;return g.value.forEach(s=>{const r=new Date(s);r.setDate(s.getDate()-s.getDay());const n=r.toISOString().split("T")[0];e.has(n)||e.set(n,{weekStart:r,days:[]}),e.get(n).days.push(s)}),Array.from(e.values())}),L=y(()=>{const e=new Map;return g.value.forEach(s=>{const r=`${s.getFullYear()}-${s.getMonth()+1}`;e.has(r)||e.set(r,{monthStart:new Date(s.getFullYear(),s.getMonth(),1),days:[]}),e.get(r).days.push(s)}),Array.from(e.values())}),T=y(()=>{const e=new Map;try{m.posts.forEach(s=>{if(!s||typeof s.time>"u"){console.warn("Invalid post data:",s);return}const r=parseInt(s.time);if(isNaN(r)){console.warn("Invalid post time:",s.time);return}const n=new Date(r*1e3);if(isNaN(n.getTime())){console.warn("Invalid date from timestamp:",r);return}const u=n.toDateString();e.has(u)||e.set(u,[]),e.get(u).push(s)})}catch(s){console.error("Error processing posts:",s)}return Object.fromEntries(e)}),N=e=>e.getDate(),V=e=>`第${P(e)}週`,Y=e=>`${e.getMonth()+1}月`,P=e=>{const s=new Date(e.getFullYear(),0,1),r=Math.floor((e-s)/(1440*60*1e3));return Math.ceil((r+s.getDay()+1)/7)},j=e=>{const s=new Date(e*1e3);return g.value.findIndex(r=>r.toDateString()===s.toDateString())},C=e=>{if(!e.startTime||!e.endTime)return null;const s=j(e.startTime),r=j(e.endTime);if(s>=0&&r>=0&&s<=r){const n=s*c.value,u=(r-s+1)*c.value;return{top:`${n}px`,height:`${u}px`,left:"50%",transform:"translateX(-50%)"}}return null},O=e=>{const s=e.getDay();return s===0||s===6},R=e=>{if(O(e))return!0;const s=e.getMonth()+1,r=e.getDate(),n=`${s}-${r}`;return x.has(n)},z=e=>{if(!e||typeof e.toDateString!="function")return!1;try{const s=e.toDateString();return T.value[s]&&T.value[s].length>0}catch(s){return console.warn("Error checking posts for day:",e,s),!1}},G=()=>{if(!_.value)return;const e=_.value.scrollTop,s=Math.floor(e/c.value),r=g.value[s];if(r){const n=r.getTime()/1e3;k.value=n,d("update:scrollTime",n)}},q=y(()=>new Date(k.value*1e3).toLocaleDateString("zh-TW",{year:"numeric",month:"long"}));return X(()=>m.startTime,e=>{k.value=e}),(e,s)=>(o(),l("div",ot,[t("div",lt,[t("div",it,f(q.value),1),t("div",{class:S(`${a.value} border-r border-gray-200 flex`)},[t("div",dt,[Q(t("select",{"onUpdate:modelValue":s[0]||(s[0]=r=>h.value=r),class:"text-xs border border-gray-300 rounded-md px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white shadow-sm","aria-label":"選擇時間單位"},[...s[1]||(s[1]=[t("option",{value:"week"},"週",-1),t("option",{value:"month"},"月",-1)])],512),[[Z,h.value]]),s[2]||(s[2]=t("span",{class:"text-xs text-gray-600 font-normal"},"時間軸",-1))]),s[3]||(s[3]=t("div",{class:"w-1/2 p-2 font-medium text-center text-xs bg-white border-r border-gray-200 flex items-center justify-center text-gray-700"}," 日期 ",-1))],2),t("div",ct,[(o(!0),l(p,null,b(i.phases,(r,n)=>(o(),l("div",{key:r.id,class:S(["flex-1 p-3 font-semibold text-center bg-gradient-to-b from-gray-50 to-gray-100 hover:from-gray-100 hover:to-gray-200 transition-all duration-200 text-gray-800",{"border-r border-gray-200":n<i.phases.length-1}])},f(r.name),3))),128))])]),D.value?g.value.length===0?(o(),l("div",mt,[...s[5]||(s[5]=[t("div",{class:"text-center"},[t("p",{class:"text-sm"},"沒有可顯示的時間資料"),t("p",{class:"text-xs text-gray-400 mt-1"},"請檢查時間設定")],-1)])])):(o(),l("div",{key:2,class:"gantt-content flex h-150 overflow-y-auto",ref_key:"scrollContainer",ref:_,onScroll:G},[t("div",{class:S(`${a.value} border-r border-gray-200`)},[h.value==="week"?(o(),l("div",gt,[(o(!0),l(p,null,b(B.value,r=>(o(),l("div",{key:r.weekStart.toISOString(),class:"week-group"},[t("div",ft,[t("div",{class:"w-1/2 p-2 font-semibold bg-gray-100 border-b border-gray-200 text-center text-xs border-r border-gray-200 flex items-center justify-center",style:w({height:r.days.length*c.value+"px"})},[t("span",yt,f(V(r.weekStart)),1)],4),t("div",vt,[(o(!0),l(p,null,b(r.days,n=>(o(),l("div",{key:n.toISOString(),class:"day-cell w-full flex flex-col items-center justify-center border-b border-gray-200",style:w({height:c.value+"px",minHeight:c.value+"px"})},[t("span",xt,f(N(n)),1)],4))),128))])])]))),128))])):h.value==="month"?(o(),l("div",ht,[(o(!0),l(p,null,b(L.value,r=>(o(),l("div",{key:r.monthStart.toISOString(),class:"month-group"},[t("div",pt,[t("div",{class:"w-1/2 p-2 font-semibold bg-gray-100 border-b border-gray-200 text-center text-xs border-r border-gray-200 flex items-center justify-center",style:w({height:r.days.length*c.value+"px"})},[t("span",bt,f(Y(r.monthStart)),1)],4),t("div",wt,[(o(!0),l(p,null,b(r.days,n=>(o(),l("div",{key:n.toISOString(),class:"day-cell w-full flex flex-col items-center justify-center border-b border-gray-200",style:w({height:c.value+"px",minHeight:c.value+"px"})},[t("span",_t,f(N(n)),1)],4))),128))])])]))),128))])):I("",!0)],2),t("div",kt,[(o(!0),l(p,null,b(i.phases,(r,n)=>(o(),l("div",{key:r.id,class:S(["phase-column flex-1 relative",{"border-r border-gray-200":n<i.phases.length-1,"flex-shrink-0":n===i.phases.length-1}])},[(o(!0),l(p,null,b(g.value,(u,$)=>(o(),l("div",{key:u.toISOString(),class:S(["phase-day-cell relative hover:bg-blue-50 transition-colors duration-200 border-b border-gray-200",{"bg-gray-100":R(u),"bg-gray-50":O(u),"has-posts":z(u)}]),style:w({height:c.value+"px",minHeight:c.value+"px"})},[z(u)?(o(),l("div",Dt,[i.avatar?(o(),l("img",{key:0,src:i.avatar,class:"w-6 h-6 rounded-full object-cover border-2 border-white shadow-md",alt:"使用者頭像"},null,8,St)):(o(),l("div",{key:1,class:"w-6 h-6 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white text-xs font-semibold shadow-md",title:`${T.value[u.toDateString()].length} 則貼文`},f(T.value[u.toDateString()].length),9,Tt))])):I("",!0)],6))),128)),C(r)?(o(),l("div",{key:0,class:"phase-line absolute w-1 bg-gradient-to-b from-blue-500 to-blue-600 opacity-75 rounded-full",style:w(C(r))},null,4)):I("",!0)],2))),128))])],544)):(o(),l("div",ut,[...s[4]||(s[4]=[t("div",{class:"text-center"},[t("p",{class:"text-sm"},"無效的時間範圍"),t("p",{class:"text-xs text-gray-400 mt-1"},"請確認開始時間小於結束時間")],-1)])]))]))}},It=H($t,[["__scopeId","data-v-8e433952"]]),At={class:"relative z-5 pt-25 w-full shadow-md bg-header text-rice-500"},Mt={class:"container mx-auto flex items-center p-4"},Nt={class:"w-1/3"},jt={class:"text"},Ct={class:"max-w-7xl mx-auto p-6"},Ot={key:0,class:"space-y-6"},zt={class:"bg-white rounded-xl shadow-lg p-6"},Et={class:"flex items-center mb-4",style:{gap:"1rem"}},Wt={class:"flex-1"},Ft={class:"text-xl font-bold text-gray-800 mb-1"},Ht={class:"text-gray-600 text-sm"},Bt={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},Lt={class:"text-gray-600 text-sm mt-1"},Vt={class:"text-gray-600 text-sm mt-1"},Yt={class:"text-gray-600 text-sm mt-1"},Pt={class:"bg-white rounded-xl shadow-lg p-6"},Rt={key:1,class:"text-center py-12 text-gray-500"},Gt={key:1,class:"flex justify-center items-center h-64"},qt={__name:"ActionDetail",setup(i){const v=tt(),m=at("handleAppScroll"),d=M(null),h=y(()=>parseInt(v.params.id)),_=y(()=>{if(!d.value||!d.value.stage)return[];const x=["#4CAF50","#2196F3","#FF9800","#9C27B0"];return Object.entries(d.value.stage).map(([a,c],g)=>({id:parseInt(a)+1,name:c.title,startTime:parseInt(c.startTime),endTime:parseInt(c.endTime),color:x[g%x.length]}))}),k=()=>{if(d.value=U.find(x=>x.id===h.value),!d.value){console.error("Action not found");return}},D=(x,a)=>{if(!x||!a)return"無";const c=new Date(x*1e3).toLocaleDateString("zh-TW"),g=new Date(a*1e3).toLocaleDateString("zh-TW");return`${c} ~ ${g}`};return et(()=>{k()}),(x,a)=>{const c=st("router-link");return o(),l("div",{class:"page-background content-scroller",onScroll:a[0]||(a[0]=(...g)=>F(m)&&F(m)(...g))},[t("div",null,[t("header",At,[t("div",Mt,[t("div",Nt,[E(c,{to:{name:"Actions"},class:"back-home-btn"},{default:A(()=>[t("span",jt,[E(nt,{align:"center"},{zh:A(()=>[...a[1]||(a[1]=[W("返回",-1)])]),en:A(()=>[...a[2]||(a[2]=[W("Back",-1)])]),_:1})]),a[3]||(a[3]=t("span",{class:"icon"},"←",-1))]),_:1})]),a[4]||(a[4]=t("div",{class:"w-1/3 text-center"},[t("h1",{class:"text-2xl md:text-3xl font-bold"},"行動詳情")],-1)),a[5]||(a[5]=t("div",{class:"w-1/3"},null,-1))])]),t("main",Ct,[d.value?(o(),l("div",Ot,[t("div",zt,[t("div",Et,[a[6]||(a[6]=t("img",{src:K,alt:"Action Image",class:"w-16 h-16 rounded-lg object-cover"},null,-1)),t("div",Wt,[t("h2",Ft,f(d.value.title),1),t("p",Ht,f(d.value.group),1)])]),t("div",Bt,[t("div",null,[a[7]||(a[7]=t("span",{class:"font-semibold text-gray-700 text-sm"},"時間：",-1)),t("p",Lt,f(D(d.value.startTime,d.value.endTime)),1)]),t("div",null,[a[8]||(a[8]=t("span",{class:"font-semibold text-gray-700 text-sm"},"進度：",-1)),t("p",Vt,f(d.value.progress)+"% ",1)]),t("div",null,[a[9]||(a[9]=t("span",{class:"font-semibold text-gray-700 text-sm"},"描述：",-1)),t("p",Yt,f(d.value.intro||"暫無描述"),1)])])]),t("div",Pt,[a[11]||(a[11]=t("h3",{class:"text-xl font-bold text-gray-800 mb-6"},"專案甘特圖",-1)),d.value.startTime&&d.value.endTime?(o(),rt(It,{key:0,"start-time":parseInt(d.value.startTime),"end-time":parseInt(d.value.endTime),phases:_.value,posts:d.value.post||[],avatar:"/thumb2.jpg"},null,8,["start-time","end-time","phases","posts"])):(o(),l("div",Rt,[...a[10]||(a[10]=[t("i",{class:"fas fa-chart-bar text-4xl text-gray-300 mb-4"},null,-1),t("p",{class:"text-lg mb-2"},"時間資訊不完整",-1),t("p",{class:"text-sm"},"無法顯示甘特圖",-1)])]))])])):(o(),l("div",Gt,[...a[12]||(a[12]=[t("div",{class:"text-gray-500"},"載入中...",-1)])]))])])],32)}}},Xt=H(qt,[["__scopeId","data-v-dbbac1f7"]]);export{Xt as default};
