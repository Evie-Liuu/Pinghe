import{_ as O,a as V}from"./lightBulb2-DVCQpNLh.js";import{r as _,c as y,a as l,o as n,b as t,t as c,e as E,h as $,k as H,F as h,l as b,p as f,d as w,n as P,z as Y,C as q,D as K,f as C,g as T,i as R,x as U,m as M,y as G}from"./index-Bp0L5y2g.js";import{C as J}from"./CJKSub-D0RY9TYY.js";const X={class:"border border-gray-300 rounded-lg overflow-hidden bg-white"},Q={class:"flex bg-gray-100 border-b border-gray-300 relative"},Z={class:"absolute top-1 left-1 text-xs text-gray-600 bg-white bg-opacity-80 px-1.5 py-0.5 rounded z-10"},tt={class:"w-20 p-3 font-bold text-center border-r border-gray-300"},et={class:"flex flex-1"},st={class:"flex w-20 border-r border-gray-300"},rt={key:0},ot={class:"flex w-full"},at={class:"w-1/2 p-2 font-bold bg-gray-200 border-b border-gray-400 text-center text-xs border-r border-gray-300"},nt={class:"w-1/2 flex items-center justify-center border-r border-gray-100 p-1"},lt={class:"text-xs text-gray-600"},it={class:"w-1/2 flex items-center justify-center p-1"},dt=["src"],ct={key:1},ut={class:"flex w-full"},mt={class:"w-1/2 p-2 font-bold bg-gray-200 border-b border-gray-400 text-center text-xs border-r border-gray-300"},gt={class:"w-1/2 flex items-center justify-center border-r border-gray-100 p-1"},vt={class:"text-xs text-gray-600"},yt={class:"w-1/2 flex items-center justify-center p-1"},xt=["src"],ht={class:"flex flex-1"},bt={key:0,class:"absolute right-1 top-1/2 transform -translate-y-1/2 z-10"},pt=["src"],ft={key:1,class:"w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs"},wt={__name:"GanttChart",props:{startTime:{type:Number,required:!0},endTime:{type:Number,required:!0},phases:{type:Array,default:()=>[]},posts:{type:Array,default:()=>[]},avatar:{type:String,default:""}},setup(u){const g=u,D=_(120),i=_(30),p=_("week"),k=_(null),S=_(g.startTime);y(()=>g.endTime-g.startTime);const x=y(()=>{const r=new Date(g.startTime*1e3),e=new Date(g.endTime*1e3),s=[],a=new Date(r);for(;a<=e;)s.push(new Date(a)),a.setDate(a.getDate()+1);return s}),m=y(()=>{const r={};return x.value.forEach(e=>{const s=new Date(e);s.setDate(e.getDate()-e.getDay());const a=s.toISOString().split("T")[0];r[a]||(r[a]={weekStart:s,days:[]}),r[a].days.push(e)}),Object.values(r)}),o=y(()=>{const r={};return x.value.forEach(e=>{const s=e.getFullYear()+"-"+(e.getMonth()+1);r[s]||(r[s]={monthStart:new Date(e.getFullYear(),e.getMonth(),1),days:[]}),r[s].days.push(e)}),Object.values(r)}),d=y(()=>{const r={};return g.posts.forEach(e=>{const a=new Date(parseInt(e.time)*1e3).toDateString();r[a]||(r[a]=[]),r[a].push(e)}),r}),v=r=>r.getDate(),W=r=>{const e=new Date(r);return e.setDate(r.getDate()+6),`${r.toLocaleDateString("zh-TW",{month:"short",day:"numeric"})} - ${e.toLocaleDateString("zh-TW",{month:"short",day:"numeric"})}`},F=r=>r.toLocaleDateString("zh-TW",{year:"numeric",month:"long"}),I=r=>{const e=new Date(r*1e3);return x.value.findIndex(s=>s.toDateString()===e.toDateString())},j=r=>{const e=I(r.startTime),s=I(r.endTime);if(e>=0&&s>=0&&e<=s){const a=e*i.value,A=(s-e+1)*i.value;return{top:a+"px",height:A+"px",left:"50%",transform:"translateX(-50%)"}}return null},L=()=>{if(!k.value)return;const r=k.value.scrollTop,e=Math.floor(r/i.value),s=x.value[e];s&&(S.value=s.getTime()/1e3)},B=y(()=>new Date(S.value*1e3).toLocaleDateString("zh-TW",{year:"numeric",month:"long"})),N=r=>{const e=r.getDay();if(e===0||e===6)return!0;const s=r.getMonth()+1,a=r.getDate();return r.getFullYear(),[{month:1,day:1},{month:2,day:10},{month:2,day:11},{month:2,day:12},{month:4,day:5},{month:4,day:4},{month:6,day:10},{month:9,day:17},{month:10,day:10}].some(z=>z.month===s&&z.day===a)};return(r,e)=>(n(),l("div",X,[t("div",Q,[t("div",Z,c(B.value),1),t("div",tt,[E(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>p.value=s),class:"block mb-1 text-xs border border-gray-300 rounded px-1 py-0.5"},[...e[1]||(e[1]=[t("option",{value:"week"},"週",-1),t("option",{value:"month"},"月",-1)])],512),[[H,p.value]]),e[2]||(e[2]=$(" 時間軸 ",-1))]),t("div",et,[(n(!0),l(h,null,b(u.phases,s=>(n(),l("div",{key:s.id,class:"p-3 font-bold text-center border-r border-gray-300 bg-gray-50",style:f({width:D.value+"px"})},c(s.name),5))),128))])]),t("div",{class:"flex h-150 overflow-y-auto",ref_key:"scrollContainer",ref:k,onScroll:L},[t("div",st,[p.value==="week"?(n(),l("div",rt,[(n(!0),l(h,null,b(m.value,s=>(n(),l("div",{key:s.weekStart,class:"week-group"},[t("div",ot,[t("div",at,c(W(s.weekStart)),1),e[3]||(e[3]=t("div",{class:"w-1/2 p-2 font-bold bg-gray-200 border-b border-gray-400 text-center text-xs"}," 貼文 ",-1))]),(n(!0),l(h,null,b(s.days,a=>(n(),l("div",{key:a,class:"flex w-full border-b border-gray-100",style:f({height:i.value+"px"})},[t("div",nt,[t("span",lt,c(v(a)),1)]),t("div",it,[d.value[a.toDateString()]&&d.value[a.toDateString()].length>0&&u.avatar?(n(),l("img",{key:0,src:u.avatar,class:"w-6 h-6 rounded-full object-cover",alt:"Avatar"},null,8,dt)):w("",!0)])],4))),128))]))),128))])):w("",!0),p.value==="month"?(n(),l("div",ct,[(n(!0),l(h,null,b(o.value,s=>(n(),l("div",{key:s.monthStart,class:"month-group"},[t("div",ut,[t("div",mt,c(F(s.monthStart)),1),e[4]||(e[4]=t("div",{class:"w-1/2 p-2 font-bold bg-gray-200 border-b border-gray-400 text-center text-xs"}," 貼文 ",-1))]),(n(!0),l(h,null,b(s.days,a=>(n(),l("div",{key:a,class:"flex w-full border-b border-gray-100",style:f({height:i.value+"px"})},[t("div",gt,[t("span",vt,c(v(a)),1)]),t("div",yt,[d.value[a.toDateString()]&&d.value[a.toDateString()].length>0&&u.avatar?(n(),l("img",{key:0,src:u.avatar,class:"w-6 h-6 rounded-full object-cover",alt:"Avatar"},null,8,xt)):w("",!0)])],4))),128))]))),128))])):w("",!0)]),t("div",ht,[(n(!0),l(h,null,b(u.phases,s=>(n(),l("div",{key:s.id,class:"border-r border-gray-100 relative",style:f({width:D.value+"px"})},[(n(!0),l(h,null,b(x.value,a=>(n(),l("div",{key:a,class:P(["border-b border-gray-100 relative",{"bg-gray-200":N(a)}]),style:f({height:i.value+"px"})},[d.value[a.toDateString()]&&d.value[a.toDateString()].length>0?(n(),l("div",bt,[u.avatar?(n(),l("img",{key:0,src:u.avatar,class:"w-5 h-5 rounded-full object-cover border border-white",alt:"Avatar"},null,8,pt)):(n(),l("div",ft,c(d.value[a.toDateString()].length),1))])):w("",!0)],6))),128)),j(s)?(n(),l("div",{key:0,class:"absolute w-0.5 bg-black",style:f(j(s))},null,4)):w("",!0)],4))),128))])],544)]))}},_t={class:"relative z-5 pt-25 w-full shadow-md bg-header text-rice-500"},Dt={class:"container mx-auto flex items-center p-4"},kt={class:"w-1/3"},St={class:"text"},Tt={class:"max-w-7xl mx-auto p-6"},$t={key:0,class:"space-y-6"},It={class:"bg-white rounded-xl shadow-lg p-6"},jt={class:"flex items-center mb-4",style:{gap:"1rem"}},At={class:"flex-1"},zt={class:"text-xl font-bold text-gray-800 mb-1"},Ct={class:"text-gray-600 text-sm"},Mt={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},Wt={class:"text-gray-600 text-sm mt-1"},Ft={class:"text-gray-600 text-sm mt-1"},Lt={class:"text-gray-600 text-sm mt-1"},Bt={class:"bg-white rounded-xl shadow-lg p-6"},Nt={key:1,class:"text-center py-12 text-gray-500"},Ot={key:1,class:"flex justify-center items-center h-64"},Vt={__name:"ActionDetail",setup(u){const g=q(),D=G("handleAppScroll"),i=_(null),p=y(()=>parseInt(g.params.id)),k=y(()=>{if(!i.value||!i.value.stage)return[];const m=["#4CAF50","#2196F3","#FF9800","#9C27B0"];return Object.entries(i.value.stage).map(([o,d],v)=>({id:parseInt(o)+1,name:d.title,startTime:parseInt(d.startTime),endTime:parseInt(d.endTime),color:m[v%m.length]}))}),S=()=>{if(i.value=V.find(m=>m.id===p.value),!i.value){console.error("Action not found");return}},x=(m,o)=>{if(!m||!o)return"無";const d=new Date(m*1e3).toLocaleDateString("zh-TW"),v=new Date(o*1e3).toLocaleDateString("zh-TW");return`${d} ~ ${v}`};return K(()=>{S()}),(m,o)=>{const d=R("router-link");return n(),l("div",{class:"page-background content-scroller",onScroll:o[0]||(o[0]=(...v)=>M(D)&&M(D)(...v))},[t("div",null,[t("header",_t,[t("div",Dt,[t("div",kt,[C(d,{to:{name:"Actions"},class:"back-home-btn"},{default:T(()=>[t("span",St,[C(J,{align:"center"},{zh:T(()=>[...o[1]||(o[1]=[$("返回",-1)])]),en:T(()=>[...o[2]||(o[2]=[$("Back",-1)])]),_:1})]),o[3]||(o[3]=t("span",{class:"icon"},"←",-1))]),_:1})]),o[4]||(o[4]=t("div",{class:"w-1/3 text-center"},[t("h1",{class:"text-2xl md:text-3xl font-bold"},"行動詳情")],-1)),o[5]||(o[5]=t("div",{class:"w-1/3"},null,-1))])]),t("main",Tt,[i.value?(n(),l("div",$t,[t("div",It,[t("div",jt,[o[6]||(o[6]=t("img",{src:O,alt:"Action Image",class:"w-16 h-16 rounded-lg object-cover"},null,-1)),t("div",At,[t("h2",zt,c(i.value.title),1),t("p",Ct,c(i.value.group),1)])]),t("div",Mt,[t("div",null,[o[7]||(o[7]=t("span",{class:"font-semibold text-gray-700 text-sm"},"時間：",-1)),t("p",Wt,c(x(i.value.startTime,i.value.endTime)),1)]),t("div",null,[o[8]||(o[8]=t("span",{class:"font-semibold text-gray-700 text-sm"},"進度：",-1)),t("p",Ft,c(i.value.progress)+"% ",1)]),t("div",null,[o[9]||(o[9]=t("span",{class:"font-semibold text-gray-700 text-sm"},"描述：",-1)),t("p",Lt,c(i.value.intro||"暫無描述"),1)])])]),t("div",Bt,[o[11]||(o[11]=t("h3",{class:"text-xl font-bold text-gray-800 mb-6"},"專案甘特圖",-1)),i.value.startTime&&i.value.endTime?(n(),U(wt,{key:0,"start-time":parseInt(i.value.startTime),"end-time":parseInt(i.value.endTime),phases:k.value,posts:i.value.post||[],avatar:"/thumb2.jpg"},null,8,["start-time","end-time","phases","posts"])):(n(),l("div",Nt,[...o[10]||(o[10]=[t("i",{class:"fas fa-chart-bar text-4xl text-gray-300 mb-4"},null,-1),t("p",{class:"text-lg mb-2"},"時間資訊不完整",-1),t("p",{class:"text-sm"},"無法顯示甘特圖",-1)])]))])])):(n(),l("div",Ot,[...o[12]||(o[12]=[t("div",{class:"text-gray-500"},"載入中...",-1)])]))])])],32)}}},Yt=Y(Vt,[["__scopeId","data-v-dbbac1f7"]]);export{Yt as default};
