import{A as U,r as p,c as _,L as A,C as F,a,o as i,b as t,f as b,g,h as C,i as G,e as x,d,v as y,n as v,F as S,l as D,m as u,j as I,t as L}from"./index-Rok5zH_O.js";import{C as M}from"./CJKSub-BHUOfDQU.js";import{u as O,i as j,a as H,b as J,E as K}from"./index-B59Gehoz.js";import{s as R}from"./SDGs_goal-BU-5yG0n.js";const q={class:"page-background content-scroller"},P={class:"pt-25 w-full z-10 shadow-md bg-header text-rice-500"},Q={class:"container mx-auto flex items-center p-4"},W={class:"w-1/3"},X={class:"text"},Y={class:"max-w-4xl mx-auto p-4 pt-10 text-[1.2rem]"},Z={class:"flex flex-col gap-4"},ee={key:0,class:"text-red-500 text-sm mt-1"},te={class:"mt-2 relative"},le={class:"relative"},se=["onClick"],oe=["placeholder"],ne=["onClick"],re={key:0,class:"px-3 py-2 text-gray-500"},ae={key:0,class:"text-red-500 text-sm mt-1"},ie={key:1,class:"text-red-500 text-sm mt-1"},ue={__name:"StoryNew",setup(de){const N=I(),o=p({title:"",img_url:"",content:"",intro:"",time:Math.floor(Date.now()/1e3),types:[]}),m=R.filter(l=>l.value!==0).map(l=>({...l,title:l.title.replace(/<br\s*\/?>/g,"")})),c=p(""),f=p(!1),w=p(null),k=_(()=>c.value?m.filter(l=>l.title.toLowerCase().includes(c.value.toLowerCase())&&!o.value.types.includes(l.value)):m.filter(l=>!o.value.types.includes(l.value))),h=_(()=>m.filter(l=>o.value.types.includes(l.value))),V=l=>{o.value.types.includes(l.value)||o.value.types.push(l.value),c.value="",f.value=!1},$=l=>{const e=o.value.types.indexOf(l);e!==-1&&o.value.types.splice(e,1)},E=()=>{},n=p({title:!1,tags:!1,content:!1}),r=O({content:"<p>開始寫下你的故事...</p>",extensions:[j,H,J.configure({nested:!0})]});A(w,()=>{f.value=!1}),F(()=>{r.value&&r.value.destroy()});const T=()=>{n.value={title:!1,tags:!1,content:!1},r.value&&(o.value.content=r.value.getHTML());let l=!1;o.value.title.trim()||(n.value.title=!0,l=!0),o.value.types.length===0&&(n.value.tags=!0,l=!0),r.value.isEmpty&&(n.value.content=!0,l=!0),!l&&(console.log("New Story Data:",o.value),alert("故事已儲存 (請查看主控台)！"),N.push("/story"))};return(l,e)=>{const z=G("router-link");return i(),a("div",q,[t("header",P,[t("div",Q,[t("div",W,[b(z,{to:"/story",class:"back-home-btn"},{default:g(()=>[t("span",X,[b(M,{align:"left"},{zh:g(()=>[...e[6]||(e[6]=[C("取消",-1)])]),en:g(()=>[...e[7]||(e[7]=[C("Cancel",-1)])]),_:1})]),e[8]||(e[8]=t("span",{class:"icon"},"←",-1))]),_:1})]),e[9]||(e[9]=t("div",{class:"w-1/3 text-center"},[t("h1",{class:"text-2xl md:text-3xl font-bold"},"建立新故事")],-1)),e[10]||(e[10]=t("div",{class:"w-1/3"},null,-1))])]),t("main",Y,[t("div",Z,[t("div",null,[e[11]||(e[11]=t("label",{for:"title",class:"block text-lg font-medium"},"標題*",-1)),x(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>o.value.title=s),id:"title",class:v(["mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":n.value.title}])},null,2),[[y,o.value.title]]),n.value.title?(i(),a("p",ee," 請輸入標題 ")):d("",!0)]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-lg font-medium"},"SDGs標籤*",-1)),t("div",te,[t("div",le,[t("div",{class:v(["flex flex-wrap items-center gap-1 p-2 border border-gray-300 rounded-md shadow-sm focus-within:ring-indigo-500 focus-within:border-indigo-500 min-h-[2.5rem]",{"border-red-500":n.value.tags}])},[(i(!0),a(S,null,D(h.value,s=>(i(),a("span",{key:s.value,class:"inline-flex items-center px-2 py-1 text-sm bg-blue-500 text-white rounded-full"},[t("span",null,L(s.title),1),t("button",{onClick:B=>$(s.value),class:"ml-1 text-white hover:text-gray-200"}," × ",8,se)]))),128)),x(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=s=>c.value=s),onFocus:e[2]||(e[2]=s=>f.value=!0),onInput:E,class:"flex-1 min-w-0 outline-none bg-transparent",placeholder:h.value.length===0?"搜尋SDGs標籤...":"",ref:"searchInput"},null,40,oe),[[y,c.value]])],2),f.value?(i(),a("div",{key:0,ref_key:"dropdown",ref:w,class:"absolute z-10 w-full bg-pblue-200 border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto mt-1"},[(i(!0),a(S,null,D(k.value,s=>(i(),a("div",{key:s.value,onClick:B=>V(s),class:"px-3 py-2 hover:bg-orange-300 cursor-pointer"},L(s.title),9,ne))),128)),k.value.length===0?(i(),a("div",re," 無匹配的標籤 ")):d("",!0)],512)):d("",!0)]),n.value.tags?(i(),a("p",ae," 請至少選擇一個SDGs標籤 ")):d("",!0)])]),t("div",null,[e[13]||(e[13]=t("label",{for:"intro",class:"block text-lg font-medium"},"簡介",-1)),x(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=s=>o.value.intro=s),id:"intro",class:"mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[y,o.value.intro]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-lg font-medium"},"內容*",-1)),u(r)?(i(),a("div",{key:0,class:v(["border p-2 flex gap-2 rounded-t-md mt-1",{"border-red-500":n.value.content}])},[t("button",{onClick:e[4]||(e[4]=s=>u(r).chain().focus().toggleTaskList().run()),class:v([{"bg-blue-200":u(r).isActive("taskList")},"p-2 rounded hover:bg-blue-200"]),title:"待辦清單"},[...e[14]||(e[14]=[t("i",{class:"fa-solid fa-list-check"},null,-1)])],2),t("button",{onClick:e[5]||(e[5]=s=>u(r).chain().focus().toggleBulletList().run()),class:v([{"bg-blue-200":u(r).isActive("bulletList")},"p-2 rounded hover:bg-blue-200"]),title:"項目符號清單"},[...e[15]||(e[15]=[t("i",{class:"fa-solid fa-list-ul"},null,-1)])],2)],2)):d("",!0),b(u(K),{editor:u(r),class:v(["w-full prose max-w-none border-x border-b p-4 rounded-b-md bg-white text-black",{"border-red-500":n.value.content}])},null,8,["editor","class"]),n.value.content?(i(),a("p",ie," 請輸入內容 ")):d("",!0)]),t("div",{class:"self-end"},[t("button",{onClick:T,class:"bg-green-500 text-white px-6 py-2 rounded-md hover:bg-green-600"}," 儲存 ")])])])])}}},me=U(ue,[["__scopeId","data-v-678e03af"]]);export{me as default};
