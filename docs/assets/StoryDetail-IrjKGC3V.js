import{_ as te,a as se,b as le,c as ae,d as oe,e as ie,f as ne,g as re,h as ue,i as de,j as ge,k as _e,l as ve,m as ce,n as me,o as pe,p as be,q as fe,r as xe,s as ye,t as ke,u as he,v as we,w as Ce,x as Se,y as Le,z as Te,A as Be,B as Ee,C as Me}from"./平和國小_mobile_Example-C6OqT14T.js";import{s as De,I as Ue,r as g,k as B,x as Ie,G as $e,c as a,o,b as t,a as d,f as E,w as M,e as P,m as ze,n as Pe,h as u,t as c,F as h,d as w,g as m,K as C,L as S,p as Ve}from"./index-Bcsves7H.js";import{i as He}from"./Story-BaIknqfO.js";import{s as V}from"./SDGs_goal-BU-5yG0n.js";import{C as je}from"./CJKSub-B_2XiD1K.js";import{u as Ae,i as Ne,a as Oe,b as Ge,E as Fe}from"./index-l6SHjf_l.js";const Re={class:"pt-25 w-full z-10 shadow-md bg-header text-rice-500"},Je={class:"container mx-auto flex items-center p-4"},Ke={class:"w-1/3"},qe={class:"text"},We={class:"max-w-4xl mx-auto p-4 pt-10 text-[1.2rem]"},Qe={key:0,class:"animate-fade-in-up flex flex-col gap-8"},Xe={class:"relative z-10 text-white"},Ye={class:"text-4xl font-bold mb-4"},Ze={class:"mb-2 text-lg"},et={class:"flex flex-wrap gap-2 mt-2"},tt={class:"flex flex-col gap-4 items-start"},st={class:"self-end flex gap-2"},lt=["innerHTML"],at={key:1,class:"w-full"},ot={key:0,class:"border p-2 flex gap-2 rounded-t-md"},it={class:"my-20"},nt={class:"flex flex-col gap-4 mb-6 text-black"},rt={class:"font-bold"},ut={class:"text-gray-800"},dt={class:"flex items-center justify-end mt-2"},gt=["onClick"],_t={class:"ml-1"},vt={key:1},ct={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 text-black"},mt={class:"bg-white p-6 rounded-md max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},pt={class:"mb-4"},bt={class:"relative flex flex-wrap items-center"},ft={key:0,class:"absolute right-2 text-red-500"},xt={key:0,class:"text-red-500 text-sm mt-1"},yt={class:"mb-4"},kt={class:"mb-4"},ht=["value"],wt={class:"mb-4"},Ct={class:"relative"},St=["innerHTML"],Lt=["onClick"],Tt=["placeholder"],Bt={key:0,class:"absolute right-2 text-red-500"},Et=["onClick","innerHTML"],Mt={key:0,class:"px-3 py-2 text-gray-500"},Dt={key:1,class:"text-red-500 text-sm mt-1"},Ut={class:"mb-4"},It={__name:"StoryDetail",props:{id:String},setup(H){const j=H,D=Ve("handleAppScroll"),{isTeacher:f}=Ue(),i=g(He.find(l=>l.id===parseInt(j.id))),v=g(!1),A=B(()=>{if(!i.value)return{};const l=i.value.img_url||"Background_2.png";try{return{backgroundImage:`url(${new URL(Object.assign({"../assets/images/Background_1.png":Me,"../assets/images/Background_1_B.png":Ee,"../assets/images/Background_1_F.png":Be,"../assets/images/Background_2.png":Te,"../assets/images/Background_Example.png":Le,"../assets/images/Bar_Selected.png":Se,"../assets/images/Bar_Unselected.png":Ce,"../assets/images/LoadingTrain.png":we,"../assets/images/Logo.gif":he,"../assets/images/MainPage_Background.png":ke,"../assets/images/MainPage_Background.webp":ye,"../assets/images/MainPage_Background_T.png":xe,"../assets/images/MainPage_Example.png":fe,"../assets/images/MainPage_Pic.png":be,"../assets/images/MainPage_Pic.webp":pe,"../assets/images/Title.png":me,"../assets/images/Train_Long.png":ce,"../assets/images/Train_Smoke.gif":ve,"../assets/images/figure1.png":_e,"../assets/images/figure2.png":ge,"../assets/images/figure3.png":de,"../assets/images/figure4.png":ue,"../assets/images/figure5.png":re,"../assets/images/lightBulb.png":ne,"../assets/images/lightBulb2.png":ie,"../assets/images/logo.png":oe,"../assets/images/logo_BW.png":ae,"../assets/images/story_bg.png":le,"../assets/images/student.png":se,"../assets/images/平和國小_mobile_Example.png":te})[`../assets/images/${l}`],import.meta.url).href})`}}catch{return{backgroundImage:`url(${new URL("/Pinghe/assets/Background_2-C9DmGNh3.png",import.meta.url).href})`}}}),r=Ae({content:"",extensions:[Ne,Oe,Ge.configure({nested:!0})]});Ie(()=>{r.value&&r.value.destroy()});const N=()=>{r.value&&r.value.commands.setContent(i.value.content||""),v.value=!0},O=()=>{r.value&&(i.value.content=r.value.getHTML()),v.value=!1,console.log("內容已儲存:",r.value.getJSON()),alert("內容已儲存！")},G=()=>{r.value&&r.value.commands.setContent(i.value.content||""),v.value=!1},F=()=>{navigator.share?navigator.share({title:i.value.title,text:i.value.intro,url:window.location.href}).catch(console.error):(navigator.clipboard.writeText(window.location.href),alert("連結已複製到剪貼簿！"))},L={author_uuid:"0",author:"我"},p=g(""),R=()=>{p.value.trim()!==""&&(i.value.comment.unshift({uuid:Date.now(),author_uuid:L.author_uuid,author:L.author,time:Date.now(),delete_time:null,text:p.value,likes:0,liked:!1}),p.value="")},J=l=>{const e=i.value.comment.find(k=>k.uuid===l);e&&(e.liked?e.likes--:e.likes++,e.liked=!e.liked)},x=g(!1),n=g({...i.value}),b=g(""),y=g(!1),U=g(null),T=V.filter(l=>l.value!==0),I=B(()=>T.filter(l=>n.value.types.includes(l.value))),$=B(()=>b.value?T.filter(l=>l.title.toLowerCase().includes(b.value.toLowerCase())&&!n.value.types.includes(l.value)):T.filter(l=>!n.value.types.includes(l.value)));$e(U,()=>{y.value=!1});const _=g({title:!1,tags:!1}),K=()=>{n.value={...i.value},x.value=!0},q=()=>{x.value=!1},W=()=>{let l=!1;n.value.title.trim()||(_.value.title=!0,l=!0),n.value.types.length===0&&(_.value.tags=!0,l=!0),!l&&(i.value.title=n.value.title,i.value.intro=n.value.intro,i.value.time=n.value.time,i.value.types=n.value.types,i.value.img_url=n.value.img_url,x.value=!1)},Q=l=>{const e=l.target.files[0];e&&(n.value.img_url=e.name)},X=l=>{const e=new Date(l.target.value);n.value.time=Math.floor(e.getTime()/1e3)},Y=l=>{n.value.types.includes(l.value)||n.value.types.push(l.value),b.value="",y.value=!1},Z=l=>{const e=n.value.types.indexOf(l);e!==-1&&n.value.types.splice(e,1)},ee=()=>{};return(l,e)=>{const k=ze("router-link");return o(),a("div",{class:"page-background content-scroller",onScroll:e[7]||(e[7]=(...s)=>u(D)&&u(D)(...s))},[t("header",Re,[t("div",Je,[t("div",Ke,[E(k,{to:"/story",class:"back-home-btn"},{default:M(()=>[t("span",qe,[E(je,{align:"center"},{zh:M(()=>[...e[8]||(e[8]=[P("回上頁",-1)])]),en:M(()=>[...e[9]||(e[9]=[P("Return",-1)])]),_:1})]),e[10]||(e[10]=t("span",{class:"icon"},"←",-1))]),_:1})]),e[11]||(e[11]=t("div",{class:"w-1/3 text-center"},null,-1)),e[12]||(e[12]=t("div",{class:"w-1/3"},null,-1))])]),t("main",We,[i.value?(o(),a("section",Qe,[t("div",{style:Pe(A.value),class:"relative bg-cover bg-center bg-opacity-70 p-7 rounded-md md:h-80 grid grid-cols-1 content-end overflow-hidden"},[e[13]||(e[13]=t("div",{class:"absolute inset-0 bg-black/40"},null,-1)),u(f)?(o(),a("button",{key:0,onClick:K,class:"absolute top-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 z-20"}," 編輯 ")):d("",!0),t("div",Xe,[t("h1",Ye,c(i.value.title),1),t("p",Ze,c(i.value.intro),1),t("small",null,c(new Date(i.value.time*1e3).toLocaleDateString()),1),t("div",et,[(o(!0),a(h,null,w(i.value.types,s=>(o(),a("span",{key:s,class:"px-3 py-1 text-sm rounded-full bg-blue-100 text-blue-800"},c(u(V)[s].title),1))),128))])])],4),t("section",tt,[t("div",st,[!v.value&&u(f)?(o(),a("button",{key:0,onClick:N,class:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600"}," 編輯內容 ")):d("",!0),v.value&&u(f)?(o(),a("button",{key:1,onClick:O,class:"bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600"}," 儲存 ")):d("",!0),v.value&&u(f)?(o(),a("button",{key:2,onClick:G,class:"bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600"}," 取消 ")):d("",!0),t("button",{onClick:F,class:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600"}," 分享 ")]),v.value?(o(),a("div",at,[u(r)?(o(),a("div",ot,[t("button",{onClick:e[0]||(e[0]=s=>u(r).chain().focus().toggleTaskList().run()),class:m([{"bg-blue-200":u(r).isActive("taskList")},"p-2 rounded hover:bg-blue-200"]),title:"待辦清單"},[...e[14]||(e[14]=[t("i",{class:"fa-solid fa-list-check"},null,-1)])],2),t("button",{onClick:e[1]||(e[1]=s=>u(r).chain().focus().toggleBulletList().run()),class:m([{"bg-blue-200":u(r).isActive("bulletList")},"p-2 rounded hover:bg-blue-200"]),title:"項目符號清單"},[...e[15]||(e[15]=[t("i",{class:"fa-solid fa-list-ul"},null,-1)])],2)])):d("",!0),E(u(Fe),{editor:u(r),class:"w-full prose max-w-none border-x border-b p-4 rounded-b-md"},null,8,["editor"])])):(o(),a("div",{key:0,class:"prose max-w-none",innerHTML:i.value.content},null,8,lt))]),t("section",it,[e[16]||(e[16]=t("h2",{class:"text-xl mb-4"},"留言板",-1)),t("div",nt,[(o(!0),a(h,null,w(i.value.comment,s=>(o(),a("div",{key:s.uuid,class:m(["p-4 rounded-md",s.author_uuid===L.author_uuid?"bg-green-100":"bg-gray-100"])},[t("p",rt,c(s.author),1),t("p",ut,c(s.text),1),t("div",dt,[t("button",{onClick:z=>J(s.uuid),class:"text-gray-500 hover:text-red-500"},[t("i",{class:m(["fa-heart",s.liked?"fa-solid text-red-500":"fa-regular"])},null,2),t("span",_t,c(s.likes),1)],8,gt)])],2))),128))]),t("div",null,[C(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>p.value=s),class:"w-full p-2 border rounded-md",rows:"3",placeholder:"在這裡寫下你的留言..."},null,512),[[S,p.value]]),t("button",{onClick:R,class:"mt-2 bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600"}," 發布留言 ")])])])):(o(),a("div",vt,[...e[17]||(e[17]=[t("p",null,"找不到這篇故事。",-1)])]))]),x.value?(o(),a("div",ct,[t("div",mt,[e[26]||(e[26]=t("h2",{class:"text-xl mb-4"},"編輯故事",-1)),t("div",pt,[e[19]||(e[19]=t("label",{class:"block text-lg font-medium mb-2"},"標題*",-1)),t("div",bt,[C(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=s=>n.value.title=s),class:m(["w-full p-2 border border-gray-300 rounded-md",{"border-red-500":_.value.title}])},null,2),[[S,n.value.title]]),_.value.title?(o(),a("div",ft,[...e[18]||(e[18]=[t("i",{class:"fa-solid fa-circle-exclamation"},null,-1)])])):d("",!0)]),_.value.title?(o(),a("p",xt," 請輸入標題 ")):d("",!0)]),t("div",yt,[e[20]||(e[20]=t("label",{class:"block text-lg font-medium mb-2"},"介紹",-1)),C(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=s=>n.value.intro=s),class:"w-full p-2 border border-gray-300 rounded-md"},null,512),[[S,n.value.intro]])]),t("div",kt,[e[21]||(e[21]=t("label",{class:"block text-lg font-medium mb-2"},"時間",-1)),t("input",{type:"date",value:n.value.time?new Date(n.value.time*1e3).toISOString().split("T")[0]:"",onInput:X,class:"w-full p-2 border border-gray-300 rounded-md"},null,40,ht)]),t("div",wt,[e[23]||(e[23]=t("label",{class:"block text-lg font-medium mb-2"},"SDGs標籤*",-1)),t("div",Ct,[t("div",{class:m(["relative flex flex-wrap items-center gap-1 p-2 border border-gray-300 rounded-md min-h-[2.5rem]",{"border-red-500":_.value.tags}])},[(o(!0),a(h,null,w(I.value,s=>(o(),a("span",{key:s.value,class:"inline-flex items-center px-2 py-1 text-sm bg-blue-500 text-white rounded-full"},[t("span",{innerHTML:s.title},null,8,St),t("button",{onClick:z=>Z(s.value),class:"ml-1 text-white hover:text-gray-200"}," × ",8,Lt)]))),128)),C(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=s=>b.value=s),onFocus:e[6]||(e[6]=s=>y.value=!0),onInput:ee,class:"flex-1 min-w-0 outline-none bg-transparent",placeholder:I.value.length===0?"搜尋SDGs標籤...":""},null,40,Tt),[[S,b.value]]),_.value.tags?(o(),a("div",Bt,[...e[22]||(e[22]=[t("i",{class:"fa-solid fa-circle-exclamation"},null,-1)])])):d("",!0)],2),y.value?(o(),a("div",{key:0,ref_key:"editDropdown",ref:U,class:"absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto mt-1"},[(o(!0),a(h,null,w($.value,s=>(o(),a("div",{key:s.value,onClick:z=>Y(s),class:"px-3 py-2 hover:bg-orange-300 cursor-pointer",innerHTML:s.title},null,8,Et))),128)),$.value.length===0?(o(),a("div",Mt," 無匹配的標籤 ")):d("",!0)],512)):d("",!0),_.value.tags?(o(),a("p",Dt," 請至少選擇一個SDGs標籤 ")):d("",!0)])]),t("div",Ut,[e[24]||(e[24]=t("label",{class:"block text-lg font-medium mb-2"},"背景圖片",-1)),t("input",{type:"file",onChange:Q,accept:"image/*",class:"w-full p-2 border border-gray-300 rounded-md"},null,32),e[25]||(e[25]=t("p",{class:"text-sm text-gray-500 mt-1"}," 選擇新圖片上傳，將替換現有背景圖片。 ",-1))]),t("div",{class:"flex justify-end gap-2"},[t("button",{onClick:q,class:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600"}," 取消 "),t("button",{onClick:W,class:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600"}," 儲存 ")])])])):d("",!0)],32)}}},At=De(It,[["__scopeId","data-v-14eb8bea"]]);export{At as default};
